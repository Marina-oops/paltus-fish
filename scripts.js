const PRODUCTS = [
    {
      id: 1,
      name: "Удилище Komandor штекерное JuniorCarp, 390см",
      price: 3905,
      image: "images/udilishe/udilishe-1.jpg",
      images: [
        "images/udilishe/udilishe-1.jpg",
        "images/udilishe/udilishe-1.2.jpg"
      ],
      description: [
        "Надежные удилища для начинающих карпятников. Композитные материалы обеспечивают прочность и устойчивость к ошибкам заброса и вываживания.",
        "Не требуют сложной техники заброса. Средний строй и мощный бланк позволяют бороться с крупной рыбой.",
        "Оснащены усиленными кольцами и разнесенной рукояткой EVA. Трехчастная конструкция для удобной транспортировки.",
        "Характеристики: Композит, EVA рукоять, средний строй, тест 100-300 гр, 3 секции, вес 490 гр, длина в сложенном виде 133 см."
      ],
      category: "УДИЛИЩА",
      subcategory: "Штекерное"
    },
    {
      id: 2,
      name: "Удилище фидерное NAMAZU Tatsujin, 3.6м, до 180гр, IM6-7",
      price: 1999,
      image: "images/udilishe/udilishe-2.jpg",
      images: [
        "images/udilishe/udilishe-2.jpg",
        "images/udilishe/udilishe-2.1.jpg"
      ],
      description: [
        "NAMAZU Tatsujin - фидерное удилище из высокомодульного карбона IM6 и IM7. Обеспечивает прочность, мощность и легкость. Подходит для ловли леща, карпа и сазана.",
        "В комплекте три сменных квивертипа для адаптации к разным условиям. Комбинированная рукоять из пробки и EVA для комфортного удержания. ",
        "Удилище оснащено надежным катушкодержателем и усиленными кольцами SiC. Длина 3,9 м, тест до 180 г, 7 колец, 3 секции.",
        "Поставляется с чехлом. Tatsujin - надежный инструмент для успешной рыбалки."
      ],
      category: "УДИЛИЩА",
      subcategory: "Фидерные"
    },
    {
      id: 3,
      name: "Удилище матчевое телескопическое Dayo Crossfire Match, 3.9м, 20-80гр",
      price: 2915,
      image: "images/udilishe/udilishe-3.jpg",
      images: [
        "images/udilishe/udilishe-3.jpg",
        "images/udilishe/udilishe-3.1.jpg"
      ],
      description: [
        "Dayo Crossfire Tele Match - матчевое удилище для береговой или морской ловли, подходит для трофейной рыбы.",
        "Оснащено большим количеством колец на одной ножке для равномерного распределения нагрузки на бланк. Кольца с облегченными металлическими лапками и керамическими вставками. Комбинированный хлыст с множеством колец для предотвращения перегибов.",
        "В комплекте чехол и защитная насадка для колец. Длина в сложенном виде: 133 см."
      ],
      category: "УДИЛИЩА",
      subcategory: "Матчевые телескопические"
    },
    {
      id: 4,
      name: "Удилище маховое б/к NAMAZU EXPANSE Pole, 7м, 15-40гр, IM7",
      price: 2317,
      image: "images/udilishe/udilishe-4.jpg",
      images: [
        "images/udilishe/udilishe-4.jpg",
        "images/udilishe/udilishe-4.1.jpg"
      ],
      description: [
        "NAMAZU EXPANSE Pole – маховое телескопическое карбоновое удилище для поплавочной ловли. Обладает высокой жесткостью, гибкостью и прочностью благодаря углеволокну.",
        "Длина 7 метров, в сложенном виде 1,26 метра. Телескопическая конструкция позволяет регулировать длину",
        "Тест 15-40 г подходит для разных видов рыб. В комплекте сумка для хранения и транспортировки."
      ],
      category: "УДИЛИЩА",
      subcategory: "Маховые"
    },
    {
      id: 5,
      name: "Удилище DY COMPETITION (с кольцами, карповое, 3.6м)",
      price: 4333,
      image: "images/udilishe/udilishe-5.jpg",
      images: [
        "images/udilishe/udilishe-5.jpg",
        "images/udilishe/udilishe-5.1.jpg"
      ],
      description: [
        "Карповые удилища – мощные бланки для дальних забросов тяжелых грузил. Обладают большим запасом прочности и позволяют комфортно работать с крупной рыбой (более 20 кг).",
        "Удилище карповое Dayo COMPETITION отличается прочностью и удобством управления. Удобная рукоятка для уверенного хвата.",
        "Обеспечивает оптимальную точность дальнего заброса и мощность для борьбы с крупной рыбой."
      ],
      category: "УДИЛИЩА",
      subcategory: "Карповые"
    },
    {
      id: 6,
      name: "Карповое удилище 390см JUNIOR CARP",
      price: 1925,
      image: "images/udilishe/udilishe-6.png",
      images: [
        "images/udilishe/udilishe-6.png"
      ],
      description: [
        "Фидерное удилище JUNIOR_CARP (тест 100-200 г) – идеальный выбор для ловли карпа, щуки, судака и другой рыбы на реках и водоёмах.",
        "Предназначено для противостояния крупной рыбе и доставки оснастки в зону кормления. Имеет продуманную геометрию, предотвращающую зацепы лески.",
        "Штекерное соединение (2 секции) для удобства сборки/разборки. Прочные усиленные кольца обеспечивают дальность заброса. Винтовой катушкодержатель для быстрой установки катушки.",
        "Легкий, прочный, удобный для фидерной ловли. Быстрый строй для точных дальних забросов с тяжелыми приманками и высокой чувствительности.",
        "Характеристики: длина 3,9 м, 9 колец, быстрый строй, вес 480 г, тест 100-200 г, материал – карбон."
      ],
      category: "УДИЛИЩА",
      subcategory: "Карповые"
    },
    {
      id: 7,
      name: "Карповое удилище RAIDЕR DOSTO CARP 3.9м, 3.25 lb. до 150гр",
      price: 4915,
      image: "images/udilishe/udilishe-7.jpg",
      images: [
        "images/udilishe/udilishe-7.jpg"
      ],
      description: [
        "RAIDER DOSTO CARP – трехсоставное карповое удилище (3,25 lb) для тяжелых оснасток (до 150 гр).",
        "Бланк из прочного углекомпозитного материала. Средний строй для увеличения дальности заброса и силового вываживания. Пропускные кольца увеличенного диаметра с вставками SiC (первое кольцо - 50 мм, тюльпан - 9,8 мм). Разнесенная рукоять с неопреновыми вставками. Винтовой катушкодержатель. Широкий хват (около 66 см). Диаметр рукояти в комеле - 24 мм.",
        "Надежное карповое удилище по доступной цене."
      ],
      category: "УДИЛИЩА",
      subcategory: "Карповые"
    },
    {
      id: 8,
      name: "Удилище штекерное карповое YINTAI Lightning Carp 3.3м, 120гр",
      price: 3925,
      image: "images/udilishe/udilishe-8.jpg",
      images: [
        "images/udilishe/udilishe-8.jpg",
        "images/udilishe/udilishe-8.1.jpg"
      ],
      description: [
        "Удилище штекерное карповое YINTAI Lightning Carp 120гр 3.3м. Легкое и прочное.",
        "Штекерная конструкция (3 секции). Вид удилища - карповое.",
        "Рекомендуется для ловли на живца с берега, ловли с тяжелыми кормушками и морских рыбалок с берега."
      ],
      category: "УДИЛИЩА",
      subcategory: "Карповые"
    },
    {
      id: 9,
      name: "Спиннинг Dy nano ATARASHII XP3 Travel (1.58м, 0.2-1гр)",
      price: 2318,
      image: "images/spinnings/spin-1.jpg",
      images: [
        "images/spinnings/spin-1.jpg",
        "images/spinnings/spin-1.1.jpg"
      ],
      description: [
        "Стекло-спиннинг от DAYO, тревел-версия (3 части). Изготовлен из стекловолокна, шпиготы - монолитное стекло. Стекловолокно придает гибкость и мягкость строю для деликатной проводки."
      ],
      category: "СПИННИНГИ",
      subcategory: "Морские"
    },
      {
      id: 10,
      name: "Спиннинг SFT Deep Sea Jig Traveler (2.1м, 300-1000гр)",
      price: 13500,
      image: "images/spinnings/spin-2.jpg",
      images: [
        "images/spinnings/spin-2.jpg"
      ],
      description: [
        "Удилище Deep Sea Jig – мощное и недорогое, из высокомодульного графита HMG24 (без стекла) для легкости и прочности.",
          "Оснащено усиленными литыми кольцами из нержавейки и алюминиево-магниевым катушкодержателем ALPS (для электрокатушки).",
          "Удобная ручка из плотного неопрена. Алюминиевая крестовина под поясной упор для равномерного распределения нагрузки.",
          "Протестировано в Норвегии. Показало себя надежным и прочным. Подходит для ловли крупной глубоководной трески и палтуса.",
          "Характеристики: длина 2.10 м, 4 секции, тест 300-1000 гр (50 lb), вес 425 грамм, длина в сложении 58 см. Упаковка: матерчатый чехол (4 секции)."
      ],
      category: "СПИННИНГИ",
      subcategory: "Морские"
      },
      {
      id: 11,
      name: "Спиннинг Yin Tai APOLLO 77073 (2.10м, 5-20гр)",
      price: 1253,
      image: "images/spinnings/spin-3.jpg",
      images: [
        "images/spinnings/spin-3.jpg",
        "images/spinnings/spin-3.1.jpg"
      ],
      description: [
        "Спиннинг Yin Tai APOLLO 77073 – высококачественное удилище для рыбалки.",
          "Изготовлен из карбона/углеволокна для прочности и долговечности. Вес всего 115 грамм. Содержит 7 колец для хорошей пропускной способности лески и 2 секции для удобства транспортировки. Длина 2.1 метра, тест 5-20 грамм. Средний строй для хорошей управляемости и чувствительности. Оборудован катушкодержателем.",
          "Надежное и качественное удилище для любителей рыбалки."
      ],
      category: "СПИННИНГИ",
      subcategory: "Штекерные"
      },
     {
      id: 12,
      name: "Спиннинг Dy PREMIER (2.70м, 100-200гр)",
      price: 1517,
      image: "images/spinnings/spin-4.jpg",
      images: [
        "images/spinnings/spin-4.jpg",
        "images/spinnings/spin-4.1.jpg"
      ],
      description: [
        "Бюджетный, универсальный спиннинг",
          "Новое поколение стеклокомпозита обеспечивает минимальный вес, высокую мощность и гибкость.",
          "Вершинка регистрирует поклевки плотвы при ловле на донную снасть и судака при джиговой проводке. Азартна ловля окуня на зимние блесны.",
          "Подходят для любых катушек и лесок (кольца SiC). Яркий цвет для видимости в любое время суток. Удобный катушкодержатель и разнесенная рукоятка из плотного EVA для комфорта."
      ],
      category: "СПИННИНГИ",
      subcategory: "Штекерные"
     },
     {
      id: 13,
      name: "Спиннинг WFT Oceanic Pro TIDECUTTER Travel (2,10м, 200-700гр)",
      price: 4250,
      image: "images/spinnings/spin-5.jpg",
      images: [
        "images/spinnings/spin-5.jpg"
      ],
      description: [
        "Спиннинг для морской рыбалки.",
          "Вершина стекловолоконных бортовых спиннингов. Подходит для троллинга, глубоководной рыбалки и ловли конгера.",
          "Компоненты высшего класса: мощный бланк из стекловолокна, титановое покрытие катушкодержателя, ручка из материала NITRO. Оборудован крестовиной на конце ручки.",
          "Большие кольца со вставками SIC в титановой раме (стойкие к солёной воде). Подходит для мультипликаторных и безынерционных катушек."
      ],
      category: "СПИННИНГИ",
      subcategory: "Морские"
     },
    {
      id: 14,
      name: "Телескопическая удочка с кольцами 240см",
      price: 1800,
      image: "images/udoshka-1.jpg",
      images: [
        "images/udoshka-1.jpg"
      ],
      description: [
        "Легкое и компактное, из переработанного графитового волокна. Подходит для ловли нехищной рыбы, на поплавок и фидер.",
          "Прочные кольца равномерно распределяют нагрузку. быстрый строй, рабочая длина (150/180/210/240 см), длина в сложенном виде 40 см, тест 15-30 грамм, вес 113/144/176/205 грамм.",
          "В комплекте чехол и защитный ударопрочный чехол для колец."
      ],
      category: "УДОЧКИ",
      subcategory: "С кольцами"
     },
    {
      id: 15,
      name: "Катушка DAYO Automne 6000 с байтраннером (5+1)",
      price: 4250,
      image: "images/katushka-1.jpg",
      images: [
        "images/katushka-1.jpg"
      ],
      description: [
        "DAYO AUTOMNE - силовая катушка для фидерных, карповых и донных удилищ. Отличные тяговые показатели.",
          "Оборудована системой Байтраннер, позволяющей стравливать леску при поклевке крупной рыбы без участия рыболова. Минимальная вибрация благодаря компьютерному проектированию. Алюминиевая шпуля. Усиленная и чувствительная ручка на 2 стороны с резиновым кнобом.",
          "Идеальна для карповой и фидерной ловли."
      ],
      category: "КАТУШКИ",
      subcategory: "Фидерные катушки"
     },
    {
      id: 16,
      name: "Леска AZOR FISHING нейлон, 100м, 0,16мм, 3,9кг",
      price: 1000,
      image: "images/leska.jpg",
      images: [
        "images/leska.jpg"
      ],
      description: [
        "Леска Azor Fishing выдерживает до 3.9 кг.",
          "Подходит для коряжистых речек. Отлично амортизирует, растягивается при рывке, сохраняя снасти и улов. Средняя прочность, не путается при забросе.",
          "Идеальна для спиннинга и поплавочной удочки."
      ],
      category: "ЛЕСКИ И ШНУРЫ",
      subcategory: "Лески"
     },
    {
      id: 17,
      name: "Катушка DAYO Leger 3000 (5+1)",
      price: 4250,
      image: "images/katushka-2.jpg",
      images: [
        "images/katushka-2.jpg"
      ],
      description: [
        "DAYO Leger 3000 (5+1) - безынерционная катушка 2022 года, зарекомендовавшая себя как надежная и качественная. Стильный дизайн, высокое качество сборки, плавный ход.",
          "Фрикционный тормоз с микрокликом для точной регулировки. Неглубокая шпуля для шнура. Дополнительная пластиковая шпуля в комплекте.",
          "Подходит для спиннинга, фидера, ловли щуки и судака."
      ],
      category: "КАТУШКИ",
      subcategory: "Для спиннингов"
     },
    {
      id: 18,
      name: "Удилище Komandor штекерное JuniorCarp, 390см",
      price: 3905,
      image: "images/udilishe/udilishe-1.jpg",
      images: [
        "images/udilishe/udilishe-1.jpg",
        "images/udilishe/udilishe-1.2.jpg"
      ],
      description: [
        "Надежные удилища для начинающих карпятников. Композитные материалы обеспечивают прочность и устойчивость к ошибкам заброса и вываживания.",
        "Не требуют сложной техники заброса. Средний строй и мощный бланк позволяют бороться с крупной рыбой.",
        "Оснащены усиленными кольцами и разнесенной рукояткой EVA. Трехчастная конструкция для удобной транспортировки.",
        "Характеристики: Композит, EVA рукоять, средний строй, тест 100-300 гр, 3 секции, вес 490 гр, длина в сложенном виде 133 см."
      ],
      category: "НОВИНКИ"
    },
    {
      id: 19,
      name: "Удилище Komandor штекерное JuniorCarp, 390см",
      price: 3905,
      image: "images/udilishe/udilishe-1.jpg",
      images: [
        "images/udilishe/udilishe-1.jpg",
        "images/udilishe/udilishe-1.2.jpg"
      ],
      description: [
        "Надежные удилища для начинающих карпятников. Композитные материалы обеспечивают прочность и устойчивость к ошибкам заброса и вываживания.",
        "Не требуют сложной техники заброса. Средний строй и мощный бланк позволяют бороться с крупной рыбой.",
        "Оснащены усиленными кольцами и разнесенной рукояткой EVA. Трехчастная конструкция для удобной транспортировки.",
        "Характеристики: Композит, EVA рукоять, средний строй, тест 100-300 гр, 3 секции, вес 490 гр, длина в сложенном виде 133 см."
      ],
      category: "БРЕНДЫ"
    },
    {
      id: 20,
      name: "Воблер LureMax KILLER 120F MDR-012 17,5 гр",
      price: 395,
      image: "images/vobler.jpg",
      images: [
        "images/vobler.jpg"
      ],
      description: [
        "Killer 120F - воблер для троллинга на глубине 2-3,5 м. Легко заглубляется и стабильно удерживает горизонт.",
        "Высокочастотная игра и шумовой эффект (акустическая камера с шариками) привлекают пассивного хищника. Оснащен системой дальнего заброса.",
        "Оснащен крючками Saikyo (Япония). Рабочий горизонт 2,5-3,5 м. Рекомендуемая скорость 2,4-5 км/ч.",
      ],
      category: "ВОБЛЕРЫ"
    },
    {
      id: 21,
      name: "Набор блесен для рыбалки 12 штук от 2,5-5г в пластиковом боксе для хранения",
      price: 1015,
      image: "images/blecn.jpg",
      images: [
        "images/blecn.jpg"
      ],
      description: [
        "Набор блесен для различных видов ловли. Изготовлены из металла, обеспечивают прочность. Вес набора менее 0,1 кг. Одинарные, подвесные крючки для надежного крепления.",
        "Поставляется в пластиковом боксе KIRUNJA. Качественный и надежный инструмент."
      ],
      category: "БЛЕСНЫ"
    },
    {
      id: 22,
      name: "Балансир рыболовный Usami Dansa 50 мм вес 8 гр",
      price: 400,
      image: "images/balansir.jpg",
      images: [
        "images/balansir.jpg"
      ],
      description: [
        "Usami Dansa 50 мм (8 грамм) - балансир для вертикальной ловли со льда. Рисует плавную восьмерку, имитируя малька.",
        "Изготовлен из морозоустойчивого ударопрочного пластика HIPS. Хвостик слит с телом. Оснащен крючками Owner.",
        "Надежный и эффективный инструмент для зимней рыбалки",
      ],
      category: "БАЛАНСИРЫ"
    },
    {
      id: 23,
      name: "Раттлины #1 70мм 16.5г",
      price: 315,
      image: "images/rattlin.jpg",
      images: [
        "images/rattlin.jpg"
      ],
      description: [
        "Раттлины – универсальные приманки для разных видов рыбалки (лёд, заброс, троллинг) как в пресной, так и в морской воде.",
        "Имеют оптимальные размеры (70 мм, 16,5 г) для различных условий и глубин. Оснащены надежными крючками Mustad."
      ],
      category: "РАТТЛИНЫ"
    },
    {
      id: 24,
      name: "Тейл-спиннер 10,5гр 30мм",
      price: 340,
      image: "images/spiner.jpg",
      images: [
        "images/spiner.jpg"
      ],
      description: [
        "Тейл-спиннер - высококачественная оснастка для спиннинговой ловли.",
        "Тейл-спиннер имеет лепесток, создающий дополнительные вибрации для привлечения рыбы. Материал - металл, обеспечивает прочность и долговечность",
        "Предназначена для ловли лосося, окуня, судака, форели, щуки и других."
      ],
      category: "ТЕЙЛ-СПИННЕРЫ"
    },
    {
      id: 25,
      name: "Силиконовая приманка для рыбалки, LJ ProSeries TIOGA",
      price: 395,
      image: "images/sea-prim.jpg",
      images: [
        "images/sea-prim.jpg"
      ],
      description: [
        "Tioga - гибридная червеобразная приманка для окуня и судака. Утолщенная передняя часть и хвостик-копытце создают привлекательные колебания. Ребрышки усиливают игру и делают движения живыми. Имеет запах макрели.",
        "Формула Scent&Taste увеличивает время удержания приманки, повышая результативность подсечки. Длина – 50 мм, силикон, медленно тонущая.",
        "Привлекает окуня, щуку, судака и другую хищную рыбу."
      ],
      category: "МОРСКИЕ"
    },
    {
      id: 26,
      name: "Муха рыболовная (мушка, стример) Playfishing 3006",
      price: 400,
      image: "images/muchi.jpg",
      images: [
        "images/muchi.jpg"
      ],
      description: [
        "Набор 3 штуки от мастерской Playfishing.",
        "Крючок: длина 32мм ширина 15мм",
      ],
      category: "МУХИ"
    },
    {
      id: 27,
      name: "Приманка тасманский дьявол 20гр",
      price: 425,
      image: "images/tasman.jpg",
      images: [
        "images/tasman.jpg"
      ],
      description: [
        "Эффективна для привлечения хищников благодаря уникальной конструкции и привлекающей игре.",
        "Обеспечивает дальний и точный заброс благодаря аэродинамике и качественным материалам. Яркая расцветка и вибрации имитируют раненую рыбу.",
        "Подходит для пресной и соленой воды, для ловли щуки, окуня, форели, судака.",
      ],
      category: "ТАСМАНСКИЕ"
    },
    {
      id: 28,
      name: "Чехол Kame для снастей и удочек, с 3 отделениями 160см",
      price: 1215,
      image: "images/chexol.jpg",
      images: [
        "images/chexol.jpg"
      ],
      description: [
        "Чехол имеет три отдельных отделения на молнии и два кармана. Изготовлен из плотного водонепроницаемого материала. Подъем 26 см, длина подъема 64 см, большой карман 60x14 см, карман маленький 30x14 см, вес 1.7 кг"
      ],
      category: "ЧЕХЛЫ"
    },
    {
      id: 29,
      name: "Тубус Fisherman",
      price: 1800,
      image: "images/tubus.jpg",
      images: [
        "images/tubus.jpg"
      ],
      description: [
        "Подходит для удилищ и удочек. Размер: 60х6см, цвет - хаки"
      ],
      category: "ТУБУСЫ"
    },
    {
      id: 30,
      name: "Палатка 2-местная Northland Valley 2",
      price: 8905,
      image: "images/palatka.jpg",
      images: [
        "images/palatka.jpg"
      ],
      description: [
        "Туристическая палатка Northland Valley 2 – идеальное решение для комфортного и экологичного отдыха на природе. Подходит для двоих.",
        "Изготовлена из экологически чистых материалов (без фторполимеров). Внутренняя часть из темного полиэстера для комфортного отдыха днем. Водонепроницаемость: тент – 5000 мм, дно – 10000 мм. Вентиляционные окна с противомоскитными сетками.",
        "Ткань обработана от ультрафиолета, что увеличивает срок службы. Надежный спутник для путешествий, обеспечивающий безопасность и комфорт."
      ],
      category: "ПАЛАТКИ"
    },
    {
      id: 31,
      name: "Ледобур HS-150D R правое вращение (LH-150RD) Helios",
      price: 2100,
      image: "images/ledobur.jpg",
      images: [
        "images/ledobur.jpg"
      ],
      description: [
        "Шнековый ледобур с правым вращением предназначен для бурения лунок во льду. Смещенные рукоятки (130мм и 150мм) позволяют бурить двумя руками, увеличивая скорость.",
        "Характеристики: диаметр бурения 150 мм, глубина 1000 мм, длина в рабочем положении 1535 мм, в сложенном 810 мм, вес 2,6 кг.",
        "Комплектуется ступенчатыми ножами 150 мм правого вращения, комплектом крепежа, защитным футляром и паспортом."
      ],
      category: "ЛЕДОБУРЫ"
    },
    {
      id: 32,
      name: "Хапуга для зимней рыбалки",
      price: 1200,
      image: "images/xapuga.jpg",
      images: [
        "images/xapuga.jpg"
      ],
      description: [
        "Хапуга – рыболовный паук-подъемник для зимней и летней рыбалки. Размер 1,5х1,5м, ячейка 4х4мм.",
        "Эффективен для ловли живца и другой рыбы. Удобен для использования с лунки: раскрывается при опускании, легко складывается при подъеме."
      ],
      category: "ХАПУГА"
    },
    {
      id: 33,
      name: "Хапуга для зимней рыбалки",
      price: 1200,
      image: "images/xapuga.jpg",
      images: [
        "images/xapuga.jpg"
      ],
      description: [
        "Хапуга – рыболовный паук-подъемник для зимней и летней рыбалки. Размер 1,5х1,5м, ячейка 4х4мм.",
        "Эффективен для ловли живца и другой рыбы. Удобен для использования с лунки: раскрывается при опускании, легко складывается при подъеме."
      ],
      category: "АКСЕССУАРЫ ДЛЯ ЗИМНЕЙ РЫБАЛКИ"
    },
    {
      id: 34,
      name: "Подсак",
      price: 1400,
      image: "images/podsak.jpg",
      images: [
        "images/podsak.jpg"
      ],
      description: [
        "Исользуется для подхвата рыбы. Длина подсака - 2.2м."
      ],
      category: "ПОДСАЧЕКИ"
    },
    {
      id: 35,
      name: "Садок металлический, круглый, с ручкой, диаметр 45 см.",
      price: 1200,
      image: "images/sadok.jpg",
      images: [
        "images/sadok.jpg"
      ],
      description: [
        "Металлический садок для рыбы, круглый, диаметр 45 см - надежный и долговечный инструмент благодаря прочному металлу и оксидированию.",
        "Круглая форма и диаметр 45 см обеспечивают удобное размещение улова. Приемное отверстие с защитным ободом и крышкой на пружине для легкой укладки рыбы.",
        "Складная конструкция облегчает транспортировку и хранение. Вес - 0,62 кг. Ячейка сетки 15 мм.",
      ],
      category: "САДКИ"
    },
    {
      id: 36,
      name: "Коробка для наживки Grantham 1,25л",
      price: 300,
      image: "images/box.jpg",
      images: [
        "images/box.jpg"
      ],
      description: [
        "Удобная емкость (1,25 л) для хранения и транспортировки насадок (животных и растительных).",
        "Изготовлена из прочного пластика и оснащена перфорированной, плотно закрывающейся крышкой.",
        "Отверстия в крышке обеспечивают надлежащее хранение живых компонентов насадки."
      ],
      category: "ЕМКОСТИ ДЛЯ НАЖИВКИ"
    },
    {
      id: 37,
      name: "Подсак",
      price: 1400,
      image: "images/podsak.jpg",
      images: [
        "images/podsak.jpg"
      ],
      description: [
        "Исользуется для подхвата рыбы. Длина подсака - 2.2м."
      ],
      category: "ИНСТРУМЕНТЫ"
    },
    {
      id: 38,
      name: "Кейс для хранения снастей Рыбиста RB-KHSM-03",
      price: 500,
      image: "images/case.jpg",
      images: [
        "images/case.jpg"
      ],
      description: [
        "Кейс Рыбиста RB-KHSM-03 герметичен благодаря резиновой проставке. Идеален для хранения рыболовных снастей, приманок и крючков. Компактный и легкий, удобен для транспортировки в рюкзаке или сумке."
      ],
      category: "КОРОБКИ И СУМКИ ДЛЯ СНАСТЕЙ"
    },
    {
      id: 39,
      name: "Универсальный держатель удочки на саморезах",
      price: 600,
      image: "images/derzh.jpg",
      images: [
        "images/derzh.jpg"
      ],
      description: [
        "Держатель удочки крепится на доску саморезами и помогает надежного фиксировать удилище. Вес 245гр, длина 22см"
      ],
      category: "ДЕРЖАТЕЛИ ДЛЯ УДИЛИЩ"
    },
    {
      id: 40,
      name: "Кукан 3,5м. AZOR FISHING",
      price: 700,
      image: "images/cucan.jpg",
      images: [
        "images/cucan.jpg"
      ],
      description: [
        "Кукан длиной 3,5 метра предназначен для хранения и транспортировки хищной рыбы.",
        "Изготовлен из высококачественных материалов, обеспечивающих прочность и надежность.",
        "Предназначен для щуки, окуня, судака и оснащен петлями для надежной фиксации улова."
      ],
      category: "КУКАНЫ"
    },
    {
      id: 41,
      name: "CARP PRO Cratus Сигнализатор поклевки электронный",
      price: 1300,
      image: "images/signal.jpg",
      images: [
        "images/signal.jpg"
      ],
      description: [
        "Carp Pro Cratus (6910-001) – электронный сигнализатор поклевки с LED-индикатором (красный). Простой, надежный, компактный и влагозащищенный.",
        "Оборудован съемными Snag Ears для защиты удилища. Индикатор из 6 светодиодов и 3 кнопки для регулировки громкости, тональности и чувствительности (6 уровней).",
        "Индикатор показывает направление поклевки. Есть разъем для свингера и ночной режим. Питание: 1 элемент ААА (1,5 В)."
      ],
      category: "СИГНАЛИЗАТОРЫ ПОКЛЕВКИ"
    },
    {
      id: 42,
      name: "Кормушка Пуля классика 60гр",
      price: 200,
      image: "images/puly.jpg",
      images: [
        "images/puly.jpg"
      ],
      description: [
        "Рыболовная кормушка Пуля обладает отличными дальнобойными характеристиками и высокой точностью заброса. Устойчива к погодным условиям благодаря конструкции с вынесенным вперед грузом.",
        "Быстро погружается, сохраняя кормовую смесь. Подходит для закрытых водоемов и рек со слабым/умеренным течением.",
        "Используется в донных снастях как груз-кормушка. Внутрь помещается каша, жмых и другие прикормки."
      ],
      category: "КОРМУШКИ"
    },
    {
      id: 43,
      name: "Рогатка FLAGMAN 6мм",
      price: 1300,
      image: "images/rogatka.jpg",
      images: [
        "images/rogatka.jpg"
      ],
      description: [
        "Легкая и прочная рогатка для рыбалки. Изготовлена из высококачественного пластика, что гарантирует долговечность.",
        "Использует тяжи 6 мм для высокой точности и дальности заброса прикормки (для поплавочной и донной ловли)."
      ],
      category: "РОГАТКИ ДЛЯ ПРИКОРМКИ"
    },
    {
      id: 44,
      name: "Электронные подвесные весы WeiHeng WH-A08 до 50кг",
      price: 395,
      image: "images/ves.jpg",
      images: [
        "images/ves.jpg"
      ],
      description: [
        "Подходят для взвешивания багажа, улова, дичи и для бытового использования. Компактные и легкие, удобно носить с собой.",
        "Работают от 2 батареек AAA."
      ],
      category: "ЭЛЕКТРОННЫЕ ВЕСЫ"
    },
    {
      id: 45,
      name: "Одинарный крючок Crazy Fish",
      price: 300,
      image: "images/1-cruc.jpg",
      images: [
        "images/1-cruc.jpg"
      ],
      description: [
        "Изготовлен из прочного металла. Серебристый цвет делает его незаметным на дне. Плавучий, облегчает контроль приманки. В комплекте 15 крючков."
      ],
      category: "КРЮЧКИ",
      subcategory: "Одинарные"
    },
    {
      id: 46,
      name: "Крючки-двойники Lucky John PREDATOR",
      price: 350,
      image: "images/2-cruc.jpg",
      images: [
        "images/2-cruc.jpg"
      ],
      description: [
        "Изготовлен из прочной стали. Бородка на жале обеспечивает надежное и быстрое закрепление рыбы. В комплекте 8 крючков."
      ],
      category: "КРЮЧКИ",
      subcategory: "Двойные"
    },
    {
      id: 47,
      name: "Крючки тройники Vmc 9649 BZ",
      price: 450,
      image: "images/3-cruc.jpg",
      images: [
        "images/3-cruc.jpg"
      ],
      description: [
        "Изготовлен из высокоуглеродистой стали. Защищен от коррозии бронзированием. Классическая форма загиба и исключительная заточка обеспечивают отличную зацепистость.",
        "Самый продаваемый тройник в мире. Используется для воблеров и блесен. Очень популярен при ловле хищной рыбы."
      ],
      category: "КРЮЧКИ",
      subcategory: "Тройные"
    },
    {
      id: 48,
      name: "Набор грузил Дробинка малый AZOR FISHING",
      price: 775,
      image: "images/gruzila-1.jpg",
      images: [
        "images/gruzila-1.jpg"
      ],
      description: [
        "Помогает доставить приманку на глубину и удерживать ее. Держит леску в натянутом положении.",
        "В комплекте свинцовые шарики разного веса для разных ситуаций."
      ],
      category: "ГРУЗИЛА",
      subcategory: "Дробинки"
    },
    {
      id: 49,
      name: "Грузило Оливки скользящие 2гр",
      price: 390,
      image: "images/gruzila-2.jpg",
      images: [
        "images/gruzila-2.jpg"
      ],
      description: [
        "Отверстие в центре для скольжения лески.",
        "Применяются для поплавочной рыбалки, удочек, донок, летних и зимних жерлиц."
      ],
      category: "ГРУЗИЛА",
      subcategory: "Оливки"
    },
    {
      id: 50,
      name: "Микро Джигер",
      price: 412,
      image: "images/djig.jpg",
      images: [
        "images/djig.jpg"
      ],
      description: [
        "Микро джиг - грузило для джиг приманок при спиннинговой ловле.",
        "Набор джиг головок, микро джиг головок на крючках №1 по 10 штук."
      ],
      category: "ГРУЗИЛА",
      subcategory: "Джиг-головки"
    },
    {
      id: 51,
      name: "Поплавок стерх 1015А",
      price: 715,
      image: "images/poplavok.jpg",
      images: [
        "images/poplavok.jpg"
      ],
      description: [
        "Изготовлен из прочных и легких материалов, вес 2.5 грамма. Обеспечивает видимость на воде и чувствительность. Легко крепится к леске и надежно удерживается на поверхности."
      ],
      category: "ПОПЛАВКИ"
    },
    {
      id: 52,
      name: "Вертлюг с карабином №7",
      price: 215,
      image: "images/vertlug.jpg",
      images: [
        "images/vertlug.jpg"
      ],
      description: [
        "Обеспечивает надежное крепление снастей. Позволяет сосредоточиться на ловле, не беспокоясь о запутывании или потере."
      ],
      category: "ВЕРТЛЮГИ"
    },
    {
      id: 53,
      name: "Карабин для рыбалки Crazy Fish Classic snap",
      price: 280,
      image: "images/carabin.jpg",
      images: [
        "images/carabin.jpg"
      ],
      description: [
        "Разрывная нагрузка 6 кг, гарантирует прочность для ловли крупной рыбы. Длина 9 мм, подходит для спиннинговой и форелевой ловли."
      ],
      category: "КАРАБИНЫ"
    },
    {
      id: 54,
      name: "Стопор рыболовный AZOR FISHING",
      price: 415,
      image: "images/stop.jpg",
      images: [
        "images/stop.jpg"
      ],
      description: [
        "Рыболовный стопор Azor Fishing предотвращает скольжение по леске поплавков, грузил и поводков. Задает границы движения элементов конструкции."
      ],
      category: "СТОПОРЫ"
    },
    {
      id: 55,
      name: "Поводки оснащенные стальные для рыбалки 15см 12кг чёрный",
      price: 286,
      image: "images/povodki-1.jpg",
      images: [
        "images/povodki-1.jpg"
      ],
      description: [
        "Чаще используются для спиннинговой рыбалки, для защиты лески от перекусывания хищником (щукой).",
        "Предотвращают перекручивание блесны с помощью вертлюга. Подходят для троллинга.",
        "В комплекте 20 шт стальных поводков длиной 15см, нагрузка 12кг.",
      ],
      category: "ПОВОДКИ",
      subcategory: "Металлические"
    },
    {
      id: 56,
      name: "Поводки флюорокарбоновые",
      price: 460,
      image: "images/povodki-2.jpg",
      images: [
        "images/povodki-2.jpg"
      ],
      description: [
        "Поводки Fluorocarbon от компании Контакт имеют чрезвычайную устойчивость к щучьим острым зубам хищника, прекрасно переносит абразивное влияние ракушек и камней. Данные качественные поводки не меняют своей кристаллической структуры, не теряют прочности, тонут в два с половиной раза быстрее нейлоновых."
      ],
      category: "ПОВОДКИ",
      subcategory: "Флюорокарбоновые"
    },
    {
      id: 57,
      name: "Раскладушка туристическая, 190см",
      price: 3905,
      image: "images/paskladushka.jpg",
      images: [
        "images/paskladushka.jpg"
      ],
      description: [
        "Походная раскладушка МЕТАЛЛ (190/65/45см, камуфляж) Vitfishing – идеальна для комфортного отдыха на природе.",
        "Прочный металлический каркас обеспечивает долговечность и устойчивость. Быстро раскладывается и складывается.",
        "Компактна в сложенном виде, легка для транспортировки. Легко очищается от грязи, устойчива на любой поверхности. Подходит для походов, кемпинга и дачи."
      ],
      category: "РАСКЛАДУШКИ"
    },
    {
      id: 58,
      name: "Рюкзак походный 80л",
      price: 3905,
      image: "images/rukzak.jpg",
      images: [
        "images/rukzak.jpg"
      ],
      description: [
        "Изготовлен из прочного и водостойкого нейлона 700D. Широкий и толстый пояс для удобства переноски.",
        "Множество карманов, усиленная прошивка в проблемных местах. Возможность дополнительного обвеса.",
        "Отлично подходит для туристов, рыбаков, охотников и других.",
      ],
      category: "РЮКЗАКИ"
    },
    {
      id: 59,
      name: "Лодка надувная ПВХ SKIF 265 гребная двухместная",
      price: 8999,
      image: "images/lodka.jpg",
      images: [
        "images/lodka.jpg"
      ],
      description: [
        "Изготовлена из прочного и долговечного ПВХ, устойчивого к влаге и ультрафиолету. Два посадочных места, весла для передвижения без мотора.",
        "Характеристики: длина 265см, ширина 124см, плотность ткани 700г/кв.м, грузоподъемность 220кг, масса 12,5кг.",
        "Комплектация: лодка, 2 сиденья, насос 5л, 2 весла, вещь-мешок, ЗИП пакет.",
      ],
      category: "ЛОДКИ"
    },
    {
      id: 60,
      name: "Удилище Komandor штекерное JuniorCarp, 390см",
      price: 3905,
      image: "images/udilishe/udilishe-1.jpg",
      images: [
        "images/udilishe/udilishe-1.jpg",
        "images/udilishe/udilishe-2.jpg",
        "images/udilishe/udilishe-3.jpg"
      ],
      description: [
        "Разработан для ловли щуки в труднодоступных местах, эффективен в технике «‎Кавер Шэдинг». Отличается высокой отзывчивостью на малейшие подвижки вершинки спиннинга и способность к активной игре.",
        "Материал: прочный пластик с текстурированным покрытием и металлизированной окраской. Система балансировки TMB с подвижными и зафиксированными шариками обеспечивает дальний заброс, живую игру и устойчивость. ",
        "Универсален в разных стилях ловли. Бюджетная цена делает воблер привлекательным для широкого круга российских рыболовов.",
      ],
      category: "ЛОДОЧНЫЕ АКСЕССУАРЫ"
    },
    {
      id: 61,
      name: "Удилище Komandor штекерное JuniorCarp, 390см",
      price: 3905,
      image: "images/udilishe/udilishe-1.jpg",
      images: [
        "images/udilishe/udilishe-1.jpg",
        "images/udilishe/udilishe-2.jpg",
        "images/udilishe/udilishe-3.jpg"
      ],
      description: [
        "Разработан для ловли щуки в труднодоступных местах, эффективен в технике «‎Кавер Шэдинг». Отличается высокой отзывчивостью на малейшие подвижки вершинки спиннинга и способность к активной игре.",
        "Материал: прочный пластик с текстурированным покрытием и металлизированной окраской. Система балансировки TMB с подвижными и зафиксированными шариками обеспечивает дальний заброс, живую игру и устойчивость. ",
        "Универсален в разных стилях ловли. Бюджетная цена делает воблер привлекательным для широкого круга российских рыболовов.",
      ],
      category: "ДОРОЖНЫЕ КОНТЕЙНЕРЫ"
    },
    {
      id: 62,
      name: "Удилище Komandor штекерное JuniorCarp, 390см",
      price: 3905,
      image: "images/udilishe/udilishe-1.jpg",
      images: [
        "images/udilishe/udilishe-1.jpg",
        "images/udilishe/udilishe-2.jpg",
        "images/udilishe/udilishe-3.jpg"
      ],
      description: [
        "Разработан для ловли щуки в труднодоступных местах, эффективен в технике «‎Кавер Шэдинг». Отличается высокой отзывчивостью на малейшие подвижки вершинки спиннинга и способность к активной игре.",
        "Материал: прочный пластик с текстурированным покрытием и металлизированной окраской. Система балансировки TMB с подвижными и зафиксированными шариками обеспечивает дальний заброс, живую игру и устойчивость. ",
        "Универсален в разных стилях ловли. Бюджетная цена делает воблер привлекательным для широкого круга российских рыболовов.",
      ],
      category: "АКСЕССУАРЫ ДЛЯ ТУРИЗМА"
    }, 
    {
      id: 63,
      name: "Маховая удочка короткого сложения 7,2м",
      price: 1180,
      image: "images/udoshka-2.jpg",
      images: [
        "images/udoshka-2.jpg"
      ],
      description: [
        "Маховое удилище - без колец, для поплавочной ловли мелкой и средней рыбы. Подходит для течения и стоячей воды.",
          "Легкое, средне-быстрый строй, коннектор для лески.",
          "В комплекте готовый набор с поплавком, двумя крючками и боковым мотовилом."
      ],
      category: "УДОЧКИ",
      subcategory: "Без колец"
     },
    {
      id: 64,
      name: "Катушка металлическая Сougayilang для нахлыста 5/6 7/8 WT, 5-6",
      price: 4250,
      image: "images/katushka-3.jpg",
      images: [
        "images/katushka-3.jpg"
      ],
      description: [
        "Прочная и жесткая конструкция. Низкопрофильная шпуля для плавного спуска лески. Преобразование правой/левой руки. Система управления сопротивлением.",
          "Тонкий внешний вид, без раскачивания и люфтов. Плавное управление. Четкий звук при отпускании лески."
      ],
      category: "КАТУШКИ",
      subcategory: "Для нахлыста"
     },
    {
      id: 65,
      name: "Катушка безынерционная XM200 с леской",
      price: 1050,
      image: "images/katushka-4.jpg",
      images: [
        "images/katushka-4.jpg"
      ],
      description: [
        "Катушка XM200 - популярная катушка среди российских рыболовов, бестселлер для донных снастей. Прочная и неприхотливая.",
          "Передний фрикцион, пластиковая шпуля 200, 2 подшипника, передаточное число 5,1:1, антиреверс. Подходит для праворуких и леворуких.",
          "Безынерционная, подходит для начинающих и опытных рыбаков. Низкая стоимость."
      ],
      category: "КАТУШКИ",
      subcategory: "Для удочек"
     },
    {
      id: 66,
      name: "Шнур плетёный Kaida Hercules Х4, длина 100 м, диаметр 0,12 мм",
      price: 4250,
      image: "images/shnur.jpg",
      images: [
        "images/shnur.jpg"
      ],
      description: [
        "Плетеный шнур Kaida Hercules - сверхпрочный, гладкий, 4 нити, 100 метров на катушке.",
          "Устойчив к износу, подходит для мест с ракушечником и камнями. Универсален для разных видов ловли.",
          "Используется в донной ловле, фидере и спиннинговой рыбалке."
      ],
      category: "ЛЕСКИ И ШНУРЫ",
      subcategory: "ШНУРЫ"
     }
    ];

const subcategories = {
    "УДИЛИЩА": ["Нахлыстовые", "Фидерные", "Матчевые штекерные", "Матчевые телескопические", "Карповые", "На горбушу"],
    "СПИННИНГИ": ["Морские", "Троллинговые", "Штекерные", "Телескопические", "Джерковые и кастинговые (курковые)"],
    "УДОЧКИ": ["С кольцами", "Без колец"],
    "КАТУШКИ": ["Для удочек", "Для нахлыста", "Для спиннингов", "Фидерные катушки"],
    "ЛЕСКИ И ШНУРЫ": ["Лески", "Шнуры"],
    "КРЮЧКИ": ["Одинарные", "Двойные", "Тройные"],
    "ГРУЗИЛА": ["Дробинки", "Оливки", "Джиг-головки"],
    "ПОВОДКИ": ["Металлические", "Флюорокарбоновые"]
  };

let catalogModule;

document.addEventListener('DOMContentLoaded', () => {
  initContactForm();
  initCallbackForms();
  initFeedbackForm();
  initMenu();
  initAccordion();
  initStars();
  initClip();
  initSliders();
  initSearch();
  if (window.location.pathname.includes('about_us.html')) {
       initSpecialistsSlider();
  }
  Cart.init();
  
  if (window.location.pathname.includes('ropes.html') || window.location.pathname.includes('new.html') || window.location.pathname.includes('brends.html') || window.location.pathname.includes('fishing_equipment.html') || window.location.pathname.includes('bait.html') || window.location.pathname.includes('fishing_accessories.html') || window.location.pathname.includes('cases_and_tubes.html') || window.location.pathname.includes('winter_fishing.html') || window.location.pathname.includes('tourism.html')) { 
      catalogModule = initProductCatalog();
      initMobileFeatures(catalogModule);
      handleResize();  
  }
   if (!window.location.pathname.includes('ropes.html') || !window.location.pathname.includes('new.html') || !window.location.pathname.includes('brends.html') || !window.location.pathname.includes('fishing_equipment.html') || !window.location.pathname.includes('bait.html') || !window.location.pathname.includes('fishing_accessories.html') || !window.location.pathname.includes('cases_and_tubes.html') || !window.location.pathname.includes('winter_fishing.html') || !window.location.pathname.includes('tourism.html')) {
      initProductCatalog();
  } 
  Cart.updateUI();
  if (document.querySelector('.cart-slider')) {
    new ProductSlider(PRODUCTS);
  }
  if (window.location.pathname.includes('search.html')) {
      initSearchPage();
  }
  if (window.location.pathname.includes('basket.html')) {
     initCheckoutRedirect();
  }
  init404Redirect();
  if (window.location.pathname.includes('make_an_order.html')) {
     initDynamicDates();
     initPaymentMethodSelection();
     initDeliveryTabs();
     initBasketRedirect();
     initDeliveryAndPaymentSelection();
     initCheckoutProcess();
  }
});

if  if (window.location.pathname.includes('ropes.html') || window.location.pathname.includes('new.html') || window.location.pathname.includes('brends.html') || window.location.pathname.includes('fishing_equipment.html') || window.location.pathname.includes('bait.html') || window.location.pathname.includes('fishing_accessories.html') || window.location.pathname.includes('cases_and_tubes.html') || window.location.pathname.includes('winter_fishing.html') || window.location.pathname.includes('tourism.html')) { 
    window.addEventListener('resize', () => {
      mobileFeaturesInitialized = false;
      initMobileFeatures(catalogModule);
      handleResize();
    });
}

// Функция для формы "contact-form"
function initContactForm() {
  const form = document.getElementById('contact-form');
  if (!form) return;

  const textarea = form.querySelector('textarea[name="message"]');
  const counter = form.querySelector('.number_characters');

  if (textarea && counter) {
      textarea.addEventListener('input', () => {
        const currentLength = textarea.value.length;
        counter.textContent = `${currentLength}/100`;
      });
  }
    
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    const inputs = form.querySelectorAll('input, textarea');
    let isValid = true;

    inputs.forEach(input => {
      if (!input.value.trim()) {
        input.style.borderColor = 'red';
        isValid = false;
      } else {
        input.style.borderColor = 'black';
      }
    });

    if (!isValid) return;

    setTimeout(() => {
      showThankYouModal();
      form.reset();
      if (counter) counter.textContent = '0/100';
    }, 500);
  });
}

// Функция для callback-форм (callback-form, callback-form_2)
function initCallbackForms() {
  const callbackForms = ['callback-form', 'callback-form_2'];
  callbackForms.forEach(formId => {
    const form = document.getElementById(formId);
    if (!form) return;

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const phoneInput = this.querySelector('input[type="tel"]');
      if (!phoneInput) return;

      let isValid = true;
      if (!phoneInput.value.trim()) {
        phoneInput.style.borderColor = 'red';
        isValid = false;
      } else {
        phoneInput.style.borderColor = 'black';
      }
      if (!isValid) return;

      setTimeout(() => {
        showThankYouModal();
        this.reset();
      }, 500);
    });
  });
}

// Функция для формы "feedback-form"
function initFeedbackForm() {
  const form = document.getElementById('feedback-form');
  if (!form) return;

  const textarea = form.querySelector('textarea[name="message"]');
  const counter = form.querySelector('.number_characters');

  if (textarea && counter) {
      textarea.addEventListener('input', () => {
        const currentLength = textarea.value.length;
        counter.textContent = `${currentLength}/170`;
      });
  }
    
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    const inputs = form.querySelectorAll('input, textarea');
    let isValid = true;

    inputs.forEach(input => {
      if (!input.value.trim()) {
        input.style.borderColor = 'red';
        isValid = false;
      } else {
        input.style.borderColor = 'black';
      }
    });

    if (!isValid) return;

    setTimeout(() => {
      showThankYouFeedbackModal();
      form.reset();
      if (counter) counter.textContent = '0/170';
    }, 500);
  });
}

// Функция для меню мобильного
function initMenu() {
  const menu = document.querySelector('.menu-mob');
  const burgerButton = document.querySelector('#hamburger-button');

  if (!menu || !burgerButton) return;

  const overlay = document.createElement('div');
  overlay.className = 'menu-overlay';
  document.body.appendChild(overlay);

  const toggleMenu = () => {
    menu.classList.toggle('active');
    document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : 'visible';
  };

  burgerButton.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleMenu();
  });

  overlay.addEventListener('click', toggleMenu);

  menu.querySelectorAll('.button_nav').forEach(item => {
    item.addEventListener('click', toggleMenu);
  });
}

// Функция для аккордеона вопросов
function initAccordion() {
  const buttons = document.querySelectorAll('.button_quest');
  if (!buttons.length) return;

  buttons.forEach(button => {
    button.addEventListener('click', () => {
      const currentContent = button.nextElementSibling;

      document.querySelectorAll('.accordion-content').forEach(content => {
        if (content !== currentContent) {
          content.classList.remove('open');
          content.previousElementSibling.classList.remove('open');
        }
      });

      currentContent.classList.toggle('open');
      button.classList.toggle('open');
    });
  });
}

// Функция для рейтинга звездочек
function initStars() {
  const stars = document.querySelectorAll('.star-img');
  const ratingInput = document.getElementById('ratingValue');
  if (!stars.length || !ratingInput) return;

  let currentRating = 0;

  stars.forEach((star, index) => {
    star.addEventListener('mouseover', () => {
      stars.forEach((s, i) => {
        s.src = i <= index ? 'images/star-full.svg' : 'images/star-empty.svg';
      });
    });

    star.addEventListener('mouseout', () => {
      stars.forEach((s, i) => {
        s.src = i < currentRating ? 'images/star-full.svg' : 'images/star-empty.svg';
      });
    });

    star.addEventListener('click', () => {
      currentRating = index + 1;
      ratingInput.value = currentRating;
    });
  });
}

// Функция для клика по скрепке и загрузки файла
function initClip() {
  const clip = document.querySelector('.clip');
  const fileInput = document.getElementById('fileInput');
  const photoButton = document.querySelector('.button_photo');

  if (!clip || !fileInput || !photoButton) return;

  clip.addEventListener('click', () => {
    fileInput.click();
  });

  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
      photoButton.innerHTML = file.name;
    }
  });
}

// Функция для слайдеров
function initSliders() {
  initSlider('.slider-track', '.dot', '.slide');
  initSlider('.slider-track-2', '.dot-2', '.slide-2');
}

function initSlider(trackSelector, dotsSelector, slidesSelector) {
  const track = document.querySelector(trackSelector);
  const dots = document.querySelectorAll(dotsSelector);
  const slides = document.querySelectorAll(slidesSelector);

  if (!track || !dots.length || !slides.length) return;

  let currentSlide = 0;

  function updateSliderPosition() {
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    dots.forEach(dot => dot.classList.remove('active'));
    dots[currentSlide].classList.add('active');
  }

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      currentSlide = index;
      updateSliderPosition();
    });
  });

  let startX = 0;
  let isDragging = false;

  track.addEventListener('mousedown', e => {
    isDragging = true;
    startX = e.clientX;
  });

  track.addEventListener('touchstart', e => {
    isDragging = true;
    startX = e.touches[0].clientX;
  });

  track.addEventListener('mouseup', e => {
    if (!isDragging) return;
    const delta = e.clientX - startX;
    handleSwipe(delta);
    isDragging = false;
  });

  track.addEventListener('touchend', e => {
    if (!isDragging) return;
    const delta = e.changedTouches[0].clientX - startX;
    handleSwipe(delta);
    isDragging = false;
  });

  function handleSwipe(delta) {
    if (delta > 50 && currentSlide > 0) {
      currentSlide--;
    } else if (delta < -50 && currentSlide < slides.length - 1) {
      currentSlide++;
    }
    updateSliderPosition();
  }
}


function createModal() {
  if (!document.querySelector('#productModal')) {
    const buttonText = window.innerWidth <= 1024 ? 
        'В корзину' : 
        'Добавить в корзину';
      
    const modalHTML = `
      <div id="productModal" class="modal-2">
        <div class="modal-content">
         <div class="title-modal-box">
          <div class="close-btn"></div>
          <h1 id="modalTitle"></h1>
          </div>
          <div class="modal-body">
            <div class="slider-product" id="modalSlider">
            </div>
            <div class="description-modal">
              <p id="modalDescription"></p>
              <div class="modal-price" id="modalPrice"></div>
              <div class="modal-actions">
                <button type="button">${buttonText}</button>
                <div class="share" type="button"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    const modal = document.querySelector('#productModal');
     const closeBtn = modal.querySelector('.close-btn');
    closeBtn.onclick = () => {
      modal.style.display = 'none';
      document.body.classList.remove('body-no-scroll');
      const scrollY = parseInt(document.body.dataset.scrollY || '0');
      window.scrollTo(0, scrollY);
      document.body.style.top = '';
      delete document.body.dataset.scrollY;
    };
  
    const closeImg = closeBtn.querySelector('img');
    if (closeImg) {
      closeImg.onclick = (e) => {
        e.stopPropagation();
        modal.style.display = 'none';
          document.body.classList.remove('body-no-scroll');
          const scrollY = parseInt(document.body.dataset.scrollY || '0');
          window.scrollTo(0, scrollY);
          document.body.style.top = '';
          delete document.body.dataset.scrollY;
      };
    }
  
    modal.onclick = (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
          document.body.classList.remove('body-no-scroll');
          const scrollY = parseInt(document.body.dataset.scrollY || '0');
          window.scrollTo(0, scrollY);
          document.body.style.top = '';
          delete document.body.dataset.scrollY;
      }
    };
    
  }
}

function showProductModal(product) {
  createModal();
  const modal = document.querySelector('#productModal');
  const scrollY = window.scrollY || document.documentElement.scrollTop;
  document.body.dataset.scrollY = scrollY;
  document.body.style.top = `-${scrollY}px`;
  document.body.classList.add('body-no-scroll');
    
  modal.style.display = 'flex';
  if (!modal) {
    console.error('Модальное окно не найдено');
    return;
  }
  modal.style.display = 'flex';

  // Заполняем данные
  modal.querySelector('#modalTitle').textContent = product.name || 'Без названия';
  modal.querySelector('#modalPrice').textContent = product.price ? `${product.price} руб.` : 'Цена не указана';

  const modalDescription = modal.querySelector('#modalDescription');
  if (Array.isArray(product.description)) {
    modalDescription.innerHTML = product.description.map(p => `<p>${p}</p>`).join('');
  } else {
    modalDescription.innerHTML = `<p>${product.description || ''}</p>`;
  }

  const modalSlider = modal.querySelector('#modalSlider');
  if (product.images && Array.isArray(product.images) && product.images.length > 0) {
    modalSlider.innerHTML = `
    <div class="slider-track-3">
      ${product.images.map((src, i) => 
        `<img src="${src}" class="modal-slide${i === 0 ? ' active' : ''}" data-index="${i}">`
      ).join('')}
    </div>
    <div class="slider-dots-wrapper">
      ${product.images.map((_, i) => 
        `<span class="dot-3${i === 0 ? ' active' : ''}" data-index="${i}"></span>`
      ).join('')}
    </div>
  `;
  
  const slides = modalSlider.querySelectorAll('.modal-slide');
  const dots = modalSlider.querySelectorAll('.dot-3');
  
  dots.forEach(dot => {
    dot.addEventListener('click', () => {
      const index = +dot.dataset.index;
  
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
      });
  
      dots.forEach(d => d.classList.remove('active'));
      dot.classList.add('active');
    });
  });

  } else {
    modalSlider.innerHTML = '<p>Изображения отсутствуют</p>';
  }

  const addToCartBtn = modal.querySelector('.modal-actions button');
  if (addToCartBtn) {
    addToCartBtn.onclick = () => {
      Cart.addProduct(product);
    };
  }

  const shareBtn = modal.querySelector('.modal-actions .share');
  if (shareBtn) {
    shareBtn.onclick = () => {
      const shareUrl = `${window.location.origin}${window.location.pathname}?product=${product.id}`;
      if (navigator.share) {
        navigator.share({
          title: product.name,
          text: 'Посмотрите этот товар!',
          url: shareUrl
        }).catch(err => console.error('Ошибка при попытке поделиться:', err));
      } else {
        navigator.clipboard.writeText(shareUrl)
          .then(() => alert('Ссылка на товар скопирована в буфер обмена'))
          .catch(err => console.error('Не удалось скопировать ссылку:', err));
      }
    };
  }  
    
  modal.style.display = 'flex';
}

let mobileFeaturesInitialized = false;
let filtersMoved = false;

function updateSubFilters() {
       if (window.innerWidth > 1024) return;
       const oldFilters = document.querySelector('.subfilters');
       if (oldFilters) {
            Array.from(oldFilters).forEach(filter => filter.remove());
        }

        const currentCategory = catalogModule.getCurrentCategory();
        const selectedSubcategories = catalogModule.getSelectedSubcategories();
        const subs = subcategories[currentCategory] || [];
        const filterDiv = document.createElement('div');
        filterDiv.className = 'subfilters';

        subs.forEach(sub => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = sub;
            checkbox.checked = selectedSubcategories.has(sub);

            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    catalogModule.addSubcategory(sub);
                } else {
                    catalogModule.removeSubcategory(sub);
                }
                catalogModule.renderProducts();
            });

            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(sub));
            filterDiv.appendChild(label);
        });

        const mobileContainer = document.querySelector('.mobile-subfilters');
        if (mobileContainer) mobileContainer.appendChild(filterDiv);
}

function initMobileFeatures(catalogModule) {
    if (window.innerWidth > 1024 || mobileFeaturesInitialized) return;
    
    initSwipeSlider();
    mobileFeaturesInitialized = true;

    const filterButton = document.querySelector('.filter');
    const filterModal = document.getElementById('filterModal');
    const closeModal = document.querySelector('.modal-header');
    const closeModal2 = document.querySelector('.apply-filter');

    const originalPriceFilterContainer = document.querySelector('.price-filter-container');
    const originalSubFiltersContainer = document.querySelector('.sub_category');

    const mobilePriceFilter = document.querySelector('.mobile-price-filter');
    const mobileSubFilters = document.querySelector('.mobile-subfilters');

    function moveFiltersToModal() {
      if (filtersMoved) return;
      if (originalPriceFilterContainer && mobilePriceFilter && !mobilePriceFilter.contains(originalPriceFilterContainer)) {
        mobilePriceFilter.appendChild(originalPriceFilterContainer);
        originalPriceFilterContainer.style.display = 'block';
      }
      updateSubFilters();
      originalSubFiltersContainer.style.display = 'block';
    
      filtersMoved = true;
    }
    
     function showFilters() {
      if (!filtersMoved) {
        moveFiltersToModal();
      } else {
          updateSubFilters();
      }
      filterModal.style.display = 'block';
      mobilePriceFilter.style.display = 'block';
      mobileSubFilters.style.display = 'block';
      originalPriceFilterContainer.style.display = 'block';
      const scrollY = window.scrollY || document.documentElement.scrollTop;
      document.body.dataset.scrollY = scrollY;
      document.body.style.top = `-${scrollY}px`;
      document.body.classList.add('body-no-scroll');
    }

    
    if (filterButton && filterModal) {
      filterButton.addEventListener('click', () => {
        showFilters();
      });
    }

    if (closeModal) {
      closeModal.addEventListener('click', () => {
        filterModal.style.display = 'none';
        mobilePriceFilter.style.display = 'none';
        mobileSubFilters.style.display = 'none';
        if (originalPriceFilterContainer && mobilePriceFilter.contains(originalPriceFilterContainer)) {
          mobilePriceFilter.removeChild(originalPriceFilterContainer);
          originalPriceFilterContainer.style.display = 'none';
        }
        originalSubFiltersContainer.style.display = 'none';
        filtersMoved = false;
        document.body.classList.remove('body-no-scroll');
        const scrollY = parseInt(document.body.dataset.scrollY || '0');
        window.scrollTo(0, scrollY);
        document.body.style.top = '';
        delete document.body.dataset.scrollY;
        if (catalogModule && typeof catalogModule.renderProducts === 'function') {
            catalogModule.renderProducts();
        }
      });
    }
    if (closeModal2) {
      closeModal2.addEventListener('click', () => {
        filterModal.style.display = 'none';
        mobilePriceFilter.style.display = 'none';
        mobileSubFilters.style.display = 'none';
        if (originalPriceFilterContainer && mobilePriceFilter.contains(originalPriceFilterContainer)) {
          mobilePriceFilter.removeChild(originalPriceFilterContainer);
          originalPriceFilterContainer.style.display = 'none';
        }
        originalSubFiltersContainer.style.display = 'none';
        filtersMoved = false;
        document.body.classList.remove('body-no-scroll');
        const scrollY = parseInt(document.body.dataset.scrollY || '0');
        window.scrollTo(0, scrollY);
        document.body.style.top = '';
        delete document.body.dataset.scrollY;
        if (catalogModule && typeof catalogModule.renderProducts === 'function') {
            catalogModule.renderProducts();
        }
      });
    }
}

function initSwipeSlider() {
  if (window.innerWidth > 1024) return;

  const wrapper = document.getElementById('categoriesWrapper');
  const container = document.getElementById('categoriesContainer');
  if (!wrapper || !container) return;

  let isDragging = false;
  let startPos = 0;
  let prevTranslate = 0;
  let animationID;

  wrapper.addEventListener('touchstart', touchStart, { passive: true });
  wrapper.addEventListener('touchend', touchEnd, { passive: true });
  wrapper.addEventListener('touchmove', touchMove, { passive: false });

  wrapper.addEventListener('mousedown', touchStart);
  wrapper.addEventListener('mouseup', touchEnd);
  wrapper.addEventListener('mouseleave', touchEnd);
  wrapper.addEventListener('mousemove', touchMove);

  function touchStart(e) {
    startPos = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
    isDragging = true;
    animationID = requestAnimationFrame(animation);
    wrapper.style.cursor = 'grabbing';
    wrapper.style.scrollBehavior = 'auto';
    if (e.type !== 'touchstart') e.preventDefault();
  }

  function touchMove(e) {
    if (!isDragging) return;
    const currentPosition = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
    const diff = currentPosition - startPos;
    wrapper.scrollLeft = prevTranslate - diff;
  }

  function touchEnd() {
    if (!isDragging) return;
    isDragging = false;
    cancelAnimationFrame(animationID);
    wrapper.style.cursor = 'grab';

    const categories = Array.from(document.querySelectorAll('.category-names'));
    const wrapperRect = wrapper.getBoundingClientRect();
    const wrapperCenter = wrapperRect.left + wrapperRect.width / 2;

    let closestCategory = null;
    let minDistance = Infinity;

    categories.forEach((category) => {
      const rect = category.getBoundingClientRect();
      const center = rect.left + rect.width / 2;
      const distance = Math.abs(center - wrapperCenter);

      if (distance < minDistance) {
        minDistance = distance;
        closestCategory = category;
      }
    });

    if (closestCategory) {
      const scrollPos = closestCategory.offsetLeft - wrapper.offsetLeft - (wrapper.offsetWidth - closestCategory.offsetWidth) / 2;
      wrapper.style.scrollBehavior = 'smooth';
      wrapper.scrollTo({ left: scrollPos, behavior: 'smooth' });

      setTimeout(() => {
        wrapper.style.scrollBehavior = 'auto';
      }, 500);
    }
  }

  function animation() {
    prevTranslate = wrapper.scrollLeft;
    animationID = requestAnimationFrame(animation);
  }

  wrapper.style.cursor = 'grab';
}

function handleResize() {
  if (window.innerWidth <= 1024) {
    initSwipeSlider();
  } else {
    const wrapper = document.getElementById('categoriesWrapper');
    if (wrapper) {
      wrapper.style.cursor = '';
      wrapper.style.scrollBehavior = '';
    }
  }
}

// Функция для товаров

function initProductCatalog() {
  let currentCategory = "УДИЛИЩА";
  if (window.location.pathname.includes('ropes.html')) {
       currentCategory = "УДИЛИЩА";
  }
  if (window.location.pathname.includes('new.html')) {
       currentCategory = "НОВИНКИ";
  }
  if (window.location.pathname.includes('brends.html')) {
       currentCategory = "БРЕНДЫ";
  }
  if (window.location.pathname.includes('bait.html')) {
       currentCategory = "ВОБЛЕРЫ";
  }
  if (window.location.pathname.includes('cases_and_tubes.html')) {
       currentCategory = "ЧЕХЛЫ";
  }
  if (window.location.pathname.includes('winter_fishing.html')) {
       currentCategory = "ПАЛАТКИ";
  }
  if (window.location.pathname.includes('fishing_accessories.html')) {
       currentCategory = "ПОДСАЧЕКИ";
  }
  if (window.location.pathname.includes('fishing_equipment.html')) {
       currentCategory = "КРЮЧКИ";
  }
  if (window.location.pathname.includes('tourism.html')) {
       currentCategory = "ЛОДКИ";
  }
  let selectedSubcategories = new Set();
  let sortAsc = true;
  let minPrice = 0;
  let maxPrice = 50000;
  let isPriceFilterVisible = false;

  const productContainer = document.querySelector('.details-grid-catalog-2');
  const categoryElements = document.querySelectorAll('.category-names');
  const filterButton = document.querySelector('.filter');
  const sortButton = document.querySelector('.sort');

 function updateCategoryCounts() {
    const categories = {
      "УДИЛИЩА": 0,
      "СПИННИНГИ": 0,
      "УДОЧКИ": 0,
      "КАТУШКИ": 0,
      "ЛЕСКИ И ШНУРЫ": 0,
      "НОВИНКИ": 0,
      "БРЕНДЫ": 0,
      "ВОБЛЕРЫ": 0,
      "БЛЕСНЫ": 0,
      "БАЛАНСИРЫ": 0,
      "РАТТЛИНЫ": 0,
      "ТЕЙЛ-СПИННЕРЫ": 0,
      "МОРСКИЕ": 0,
      "МУХИ": 0,
      "ТАСМАНСКИЕ": 0,
      "ЧЕХЛЫ": 0,
      "ТУБУСЫ": 0,
      "ПАЛАТКИ": 0,
      "ЛЕДОБУРЫ": 0,
      "ХАПУГА": 0,
      "АКСЕССУАРЫ ДЛЯ ЗИМНЕЙ РЫБАЛКИ": 0,
      "ПОДСАЧЕКИ": 0,
      "САДКИ": 0,
      "ЕМКОСТИ ДЛЯ НАЖИВКИ": 0,
      "ИНСТРУМЕНТЫ": 0,
      "КОРОБКИ И СУМКИ ДЛЯ СНАСТЕЙ": 0,
      "ДЕРЖАТЕЛИ ДЛЯ УДИЛИЩ": 0,
      "КУКАНЫ": 0,
      "СИГНАЛИЗАТОРЫ ПОКЛЕВКИ": 0,
      "КОРМУШКИ": 0,
      "РОГАТКИ ДЛЯ ПРИКОРМКИ": 0,
      "ЭЛЕКТРОННЫЕ ВЕСЫ": 0,
      "КРЮЧКИ": 0,
      "ГРУЗИЛА": 0,
      "ПОПЛАВКИ": 0,
      "ПОВОДКИ": 0,
      "ВЕРТЛЮГИ": 0,
      "КАРАБИНЫ": 0,
      "СТОПОРЫ": 0,
      "ЛОДКИ": 0,
      "ЛОДОЧНЫЕ АКСЕССУАРЫ": 0,
      "РЮКЗАКИ": 0,
      "РАСКЛАДУШКИ": 0,
      "ДОРОЖНЫЕ КОНТЕЙНЕРЫ": 0,
      "АКСЕССУАРЫ ДЛЯ ТУРИЗМА": 0
    };

    PRODUCTS.forEach(product => {
      if (categories.hasOwnProperty(product.category)) {
        categories[product.category]++;
      }
    });

    document.querySelectorAll('.category-names').forEach(categoryElement => {
      const categoryName = categoryElement.querySelector('.category-names-text').textContent;
      const countElement = categoryElement.querySelector('.number-category-names');
      
      if (categories.hasOwnProperty(categoryName) && countElement) {
        countElement.textContent = `(${categories[categoryName]})`;
      }
    });
  }
    
  function renderProducts() {
    if (!productContainer) return;

    let filtered = PRODUCTS.filter(p => p.category === currentCategory);

    if (selectedSubcategories.size > 0) {
      filtered = filtered.filter(p => selectedSubcategories.has(p.subcategory));
    }

    filtered = filtered.filter(p => p.price >= minPrice && p.price <= maxPrice);
    filtered.sort((a, b) => sortAsc ? a.price - b.price : b.price - a.price);

    updateCurrentCategoryCount(filtered.length);

    productContainer.innerHTML = '';
    filtered.forEach(product => {
      const productDiv = document.createElement('div');
      productDiv.className = 'product';

     const buttonText = window.innerWidth <= 1024 ? 
        'В корзину' : 
        'Добавить в корзину';
        
      productDiv.innerHTML = `
        <div class="product">
          <div class="block-review">
            <img src="${product.image}" alt="Категория">
          </div>
          <div class="line-product"></div>
          <div class="name_product">${product.name}</div>
          <div class="cost">${product.price} руб.</div>
          <div class="buttons_products">
            <button type="button" data-id="${product.id}">${buttonText}</button>
            <div class="share" type="button" data-id="${product.id}"></div>
          </div>
        </div>
      `;
      productContainer.appendChild(productDiv);

    productDiv.querySelector('.block-review').addEventListener('click', () => {
      showProductModal(product);
    });

    productDiv.querySelector('button[data-id]').addEventListener('click', () => {
        Cart.addProduct(product);

        const btn = productDiv.querySelector('button[data-id]');
              const addedText = window.innerWidth <= 1024 ? 
                'В корзину' : 
                'Добавить в корзину';
        
              btn.textContent = 'Добавлено!';
              setTimeout(() => {
                btn.textContent = addedText;
              }, 1000);
    });
      
    const shareButton = productDiv.querySelector('.share');
    if (shareButton) {
      shareButton.addEventListener('click', () => {
        const shareUrl = `${window.location.origin}${window.location.pathname}?product=${product.id}`;
        
        if (navigator.share) {
          navigator.share({
            title: product.name,
            text: 'Посмотрите этот товар!',
            url: shareUrl
          }).catch(err => {
            console.error('Ошибка при попытке поделиться:', err);
          });
        } else {
          navigator.clipboard.writeText(shareUrl).then(() => {
            alert('Ссылка на товар скопирована в буфер обмена');
          }).catch(err => {
            console.error('Не удалось скопировать ссылку:', err);
          });
        }
      });
    }
            
    });

 }
    
  if (window.location.pathname.includes('basket.html')) {
    if (PRODUCTS && PRODUCTS.length > 0) {
      new ProductSlider(PRODUCTS);
    }
  }
  
  function addToCart() {
    cartCount++;
    if (cartCounter) {
      cartCounter.textContent = cartCount;
    }
  }

  if (categoryElements.length) {
    categoryElements.forEach(cat => {
      cat.addEventListener('click', () => {
        categoryElements.forEach(el => el.classList.remove('active'));
        cat.classList.add('active');

        const catTextElem = cat.querySelector('.category-names-text');
        if (catTextElem) {
          currentCategory = catTextElem.textContent;
        }
        selectedSubcategories.clear();
        if (window.innerWidth <= 1024) {
            updateSubFilters();
        }
        const priceFilterContainer = document.querySelector('.price-filter-container');
        if (priceFilterContainer) {
          priceFilterContainer.style.display = 'none';
          isPriceFilterVisible = false;
          
          const fishElement = document.querySelector('.fish_desktop_aside_1');
          if (fishElement) {
            fishElement.classList.remove('fish-filter-active');
            fishElement.classList.add('fish-filter-inactive');
          }
        }
          
        renderProducts();
        removeSubFilter();
      });
    });

    categoryElements.forEach(cat => {
      const catTextElem = cat.querySelector('.category-names-text');
      if (catTextElem && catTextElem.textContent === currentCategory) {
        cat.classList.add('active');
      }
    });
  }

  if (sortButton) {
    sortButton.addEventListener('click', () => {
      sortAsc = !sortAsc;
      renderProducts();
    });
  }

  if (filterButton) {
    filterButton.addEventListener('click', () => {
      
      const priceFilterContainer = document.querySelector('.price-filter-container');
      const fishElement = document.querySelector('.fish_desktop_aside_1');
      isPriceFilterVisible = !isPriceFilterVisible;
        
      if (priceFilterContainer) {
        priceFilterContainer.style.display = isPriceFilterVisible ? 'block' : 'none';
      }  

        if (fishElement) {
            if (isPriceFilterVisible) {
              fishElement.classList.remove('fish-filter-inactive');
              fishElement.classList.add('fish-filter-active');
            } else {
              fishElement.classList.remove('fish-filter-active');
              fishElement.classList.add('fish-filter-inactive');
            }
        }
        
      const filters = document.querySelector('.subfilters');
      if (filters) {
        filters.remove();
      } else {
        showSubFilter();
      }
    });
  }

 function updateCurrentCategoryCount(count) {
    const activeCategory = document.querySelector('.category-names.active');
    if (activeCategory) {
      const countElement = activeCategory.querySelector('.number-category-names');
      if (countElement) {
        countElement.textContent = `(${count})`;
      }
    }
 }
    
  function showSubFilter() {
    const subs = subcategories[currentCategory] || [];
    const filterDiv = document.createElement('div');
    filterDiv.className = 'subfilters';

    subs.forEach(sub => {
      const label = document.createElement('label');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = sub;
      checkbox.checked = selectedSubcategories.has(sub);

      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          selectedSubcategories.add(sub);
        } else {
          selectedSubcategories.delete(sub);
        }
        renderProducts();
      });

      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(sub));
      filterDiv.appendChild(label);
    });

    const container = document.querySelector('.sub_category');
    if (container) {
      container.appendChild(filterDiv);
    }
  }

  function removeSubFilter() {
    const filters = document.querySelector('.subfilters');
    if (filters) filters.remove();

    minPrice = 0;
    maxPrice = 50000;
    
    const minPriceInput = document.getElementById('minPrice');
    const maxPriceInput = document.getElementById('maxPrice');
    if (minPriceInput) minPriceInput.value = minPrice;
    if (maxPriceInput) maxPriceInput.value = maxPrice;
  }

  const minPriceInput = document.getElementById('minPrice');
  const maxPriceInput = document.getElementById('maxPrice');
  const sliderMin = document.getElementById('sliderMin');
  const sliderMax = document.getElementById('sliderMax');
  const applyPriceFilterBtn = document.querySelector('.apply-price-filter');

  function updateInputs() {
    if (minPriceInput) minPriceInput.value = minPrice;
    if (maxPriceInput) maxPriceInput.value = maxPrice;
    if (sliderMin) sliderMin.value = minPrice;
    if (sliderMax) sliderMax.value = maxPrice;
  }

  if (minPriceInput) {
    minPriceInput.addEventListener('input', function() {
      const value = Math.min(parseInt(this.value) || 0, maxPrice);
      minPrice = value;
      if (sliderMin) sliderMin.value = value;
    });
  }

  if (maxPriceInput) {
    maxPriceInput.addEventListener('input', function() {
      const value = Math.max(parseInt(this.value) || 10000, minPrice);
      maxPrice = value;
      if (sliderMax) sliderMax.value = value;
    });
  }

  if (sliderMin) {
    sliderMin.addEventListener('input', function() {
      const value = Math.min(parseInt(this.value), maxPrice);
      minPrice = value;
      if (minPriceInput) minPriceInput.value = value;
    });
  }

  if (sliderMax) {
    sliderMax.addEventListener('input', function() {
      const value = Math.max(parseInt(this.value), minPrice);
      maxPrice = value;
      if (maxPriceInput) maxPriceInput.value = value;
    });
  }

  if (applyPriceFilterBtn) {
    applyPriceFilterBtn.addEventListener('click', function() {
      renderProducts();
    });
  }

  updateCategoryCounts();
  updateInputs();
  renderProducts();

  return {
    renderProducts,
    getCurrentCategory: () => currentCategory,
    getSelectedSubcategories: () => selectedSubcategories,
    addSubcategory: (sub) => selectedSubcategories.add(sub),
    removeSubcategory: (sub) => selectedSubcategories.delete(sub)
  };
    const urlParams = new URLSearchParams(window.location.search);
    const productIdFromUrl = urlParams.get('product');
    
    if (productIdFromUrl) {
      const productToShow = PRODUCTS.find(p => p.id == productIdFromUrl);
      if (productToShow) {
        setTimeout(() => {
          showProductModal(productToShow);
        }, 0);
      }
    }
}

function initSpecialistsSlider() {
    
  const slider = document.querySelector('.slider-specialists');
  const slides = document.querySelectorAll('.content-specialists');
  const prevBtn = document.querySelector('.arrow-left');
  const nextBtn = document.querySelector('.arrow-right');
  
  if (!slider || !slides.length || !prevBtn || !nextBtn) return;

  let currentSlide = 0;
  const slideCount = slides.length;

  const showSlide = (index) => {
    currentSlide = index;
    const offset = -currentSlide * 100;
    slider.style.transform = `translateX(${offset}%)`;
    
    renderProductsForSpecialist(index);
  };
    
  const renderProductsForSpecialist = (specialistIndex) => {
    const container = slides[specialistIndex].querySelector('.top-specialists-products');
    
     if (!container || container.dataset.loaded === 'true') return;
    
    const productIds = [
      [2, 4, 6],
      [11, 6, 12],
      [1, 9, 10]
    ][specialistIndex] || [];
      
    const products = PRODUCTS.filter(p => productIds.includes(p.id));

    if (!products.length) return;
    
    container.innerHTML = '';
    
    products.forEach(product => {
      const productDiv = document.createElement('div');
      productDiv.className = 'product';
      productDiv.innerHTML = `
        <div class="product">
        <div class="block-review">
          <img src="${product.image}" alt="${product.name}">
        </div>
        <div class="line-product"></div>
        <div class="name_product">${product.name}</div>
        <div class="cost">${product.price} руб.</div>
        <button type="button" data-id="${product.id}">В корзину</button>
      </div>
    `;
    container.appendChild(productDiv);

    productDiv.querySelector('.block-review').addEventListener('click', () => {
      showProductModal(product);
    });

    productDiv.querySelector('button[data-id]').addEventListener('click', () => {
      Cart.addProduct(product);
      
      const btn = productDiv.querySelector('button[data-id]');
      btn.textContent = 'Добавлено!';
      setTimeout(() => {
        btn.textContent = 'В корзину';
      }, 1000);
    });
   });
    container.dataset.loaded = 'true';
  };
    
   prevBtn.addEventListener('click', () => {
    const newIndex = (currentSlide - 1 + slideCount) % slideCount;
    showSlide(newIndex);
  });

  nextBtn.addEventListener('click', () => {
    const newIndex = (currentSlide + 1) % slideCount;
    showSlide(newIndex);
  });
    
    showSlide(0);
    
    window.addEventListener('resize', () => {
    showSlide(currentSlide);
  });
}

class ProductSlider {
  
  constructor(PRODUCTS) {
    this.PRODUCTS = PRODUCTS;
    this.sliderWrapper = document.querySelector('.cart-slider');
    this.sliderContainer = document.querySelector('.slider-items');
    this.prevBtn = document.querySelector('.slider-arrow.prev');
    this.nextBtn = document.querySelector('.slider-arrow.next');
    this.currentIndex = 0;
    this.visibleItems = 5;
    this.itemWidth = 0;

    if (this.sliderWrapper && this.sliderContainer && this.prevBtn && this.nextBtn) {
      this.initSlider();
    } else {
      console.error('Не найдены необходимые элементы для слайдера');
    }
  }

  initSlider() {
    if (!this.PRODUCTS.length) return;
    this.calculateItemWidth(); 
    this.renderProducts();
    this.setupEventListeners();
    this.updateSlider();
  }

  calculateItemWidth() {
    const sliderWidth = this.sliderWrapper.offsetWidth;
    this.itemWidth = sliderWidth / this.visibleItems;
  }
  
  renderProducts() {
    this.sliderContainer.innerHTML = '';
    this.sliderContainer.style.width = `${this.PRODUCTS.length * this.itemWidth}px`;
    
    this.PRODUCTS.forEach(product => {
      const productDiv = document.createElement('div');
      productDiv.className = 'product';
      productDiv.style.width = `${this.itemWidth}px`;
      const buttonText = window.innerWidth <= 1024 ? 
        'В корзину' : 
        'Добавить в корзину';
      productDiv.innerHTML = `
        <div class="product">
          <div class="block-review">
            <img src="${product.image}" alt="${product.name}">
          </div>
          <div class="line-product"></div>
          <div class="name_product">${product.name}</div>
          <div class="cost">${product.price} руб.</div>
          <div class="buttons_products">
            <button type="button" data-id="${product.id}">${buttonText}</button>
          </div>
        </div>
      `;
      this.sliderContainer.appendChild(productDiv);

      // Добавляем обработчики событий
      productDiv.querySelector('.block-review').addEventListener('click', () => {
        showProductModal(product);
      });

      productDiv.querySelector('button[data-id]').addEventListener('click', () => {
        Cart.addProduct(product);

          const btn = productDiv.querySelector('button[data-id]');
              const addedText = window.innerWidth <= 1024 ? 
                'В корзину' : 
                'Добавить в корзину';
              btn.textContent = 'Добавлено!';
              setTimeout(() => {
                btn.textContent = addedText;
              }, 1000);
      });
    });
  }

  setupEventListeners() {
    this.prevBtn.addEventListener('click', () => this.move(-1));
    this.nextBtn.addEventListener('click', () => this.move(1));
    
    window.addEventListener('resize', () => {
      this.calculateItemWidth();
      this.updateSlider();
    });
  }
  
  move(direction) {
    const newIndex = this.currentIndex + direction;
    
    // Проверяем границы
    if (newIndex >= 0 && newIndex <= this.PRODUCTS.length - this.visibleItems) {
      this.currentIndex = newIndex;
      this.updateSlider();
    }
  }

  updateSlider() {
    const offset = -this.currentIndex * this.itemWidth;
    this.sliderContainer.style.transform = `translateX(${offset}px)`;
    this.updateControls();
  }

  updateControls() {
    this.prevBtn.style.display = this.currentIndex <= 0 ? 'none' : 'block';
    this.nextBtn.style.display = this.currentIndex >= this.PRODUCTS.length - this.visibleItems ? 'none' : 'block';
  }
}

// Модальные окна
function showThankYouModal() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal">
      <div class="close-btn"></div>
      <h2>ВАША ЗАЯВКА ОТПРАВЛЕНА!</h2>
      <p style="font-weight: 700;">Спасибо за обращение!</p>
      <p style="font-weight: 700;">Если заявка отправлена в&nbsp;будни с&nbsp;9:00 до&nbsp;18:00 —&nbsp;мы&nbsp;свяжемся с&nbsp;вами в&nbsp;течение&nbsp;30&nbsp;минут</p>
      <p style="color: white;">Д</p>
      <p>В другое время ответим утром следующего рабочего дня</p>
    </div>
  `;
  document.body.appendChild(modal);

  modal.querySelector('.close-btn').addEventListener('click', () => {
    modal.remove();
  });
}

function showThankYouFeedbackModal() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal">
      <div class="close-btn"></div>
      <h2>СПАСИБО ЗА ВАШ ОТЗЫВ!</h2>
      <p style="font-weight: 700;">Мы признательны вам за&nbsp;вашу&nbsp;оценку! Она&nbsp;будет полезна другим пользователям</p>
      <p style="color: white;">Д</p>
      <p>После проверки отзыва на&nbsp;соответствие требованиям, он&nbsp;будет опубликован на&nbsp;сайте! Мы сообщим вам об&nbsp;этом по&nbsp;электронной почте</p>
    </div>
  `;
  document.body.appendChild(modal);

  modal.querySelector('.close-btn').addEventListener('click', () => {
    modal.remove();
  });
}

function initSearch() {
  const searchInput = document.querySelector('.search-input');
  const searchIcon = document.querySelector('.search-icon');
  const searchForm = document.querySelector('.search-wrapper');

  if (!searchInput || !searchIcon) return;

  const handleSearch = (e) => {
   if (e) e.preventDefault();
    const searchTerm = searchInput.value.trim();
    if (searchTerm) {
      localStorage.setItem('searchQuery', searchTerm);
     window.location.href = `search.html?query=${encodeURIComponent(searchTerm)}`;
    }
  };

  searchForm.addEventListener('submit', handleSearch);
  
  searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.keyCode === 13) {
      handleSearch(e);
    }
  });

  searchIcon.addEventListener('click', handleSearch);
  }

function initSearchPage() {
  const urlParams = new URLSearchParams(window.location.search);
  let searchQuery = urlParams.get('query') || localStorage.getItem('searchQuery') || '';

  if (!urlParams.has('query') && searchQuery) {
    window.history.replaceState(null, null, `?query=${encodeURIComponent(searchQuery)}`);
  }
    
  const productContainer = document.querySelector('.details-grid-catalog-2');
  if (!productContainer) return;
  
  const filteredProducts = PRODUCTS.filter(product => 
    product.name.toLowerCase().includes(searchQuery.toLowerCase())
  );

  renderSearchResults(filteredProducts, productContainer);
  updateSearchHeader(filteredProducts.length, searchQuery);
}

function renderSearchResults(PRODUCTS, container) {
  container.innerHTML = '';

  if (PRODUCTS.length === 0) {
    container.innerHTML = '<p class="no-results">По вашему запросу ничего не найдено</p>';
    return;
  }

  PRODUCTS.forEach(product => {
    const productDiv = document.createElement('div');
    productDiv.className = 'product';
    const buttonText = window.innerWidth <= 1024 ? 
        'В корзину' : 
        'Добавить в корзину';
    productDiv.innerHTML = `
      <div class="product">
        <div class="block-review">
          <img src="${product.image}" alt="${product.name}">
        </div>
        <div class="line-product"></div>
        <div class="name_product">${product.name}</div>
        <div class="cost">${product.price} руб.</div>
        <div class="buttons_products">
          <button type="button" data-id="${product.id}">${buttonText}</button>
        </div>
      </div>
    `;
    container.appendChild(productDiv);

    productDiv.querySelector('.block-review').addEventListener('click', () => {
        showProductModal(product);
      });

      productDiv.querySelector('button[data-id]').addEventListener('click', () => {
        Cart.addProduct(product);
         const btn = productDiv.querySelector('button[data-id]');
          const addedText = window.innerWidth <= 1024 ? 
                'В корзину' : 
                'Добавить в корзину';
          btn.textContent = 'Добавлено!';
          setTimeout(() => {
            btn.textContent = addedText;
          }, 1000);
      });
  });
}

function updateSearchHeader(count, query) {
  const resultsHeader = document.querySelector('.search-results-header');
  if (resultsHeader) {
    resultsHeader.innerHTML = count > 0 
      ? `Найдено ${count} товаров по запросу &laquo;${query}&raquo;`
      : `По запросу &laquo;${query}&raquo; ничего не найдено`;
  }
}

const Cart = {
  items: [],
  isInitialized: false,
  deliveryCost: 0,
  // Инициализация корзины
  init() {
    if (this.isInitialized) return;
      
    this.cacheElements();
    this.bindEvents();
    this.restoreCartState();
    this.updateUI();
    this.isInitialized = true;
  },

  // Кэширование DOM-элементов
  cacheElements() {
    this.elements = {
      cartButton: document.getElementById('cart-button'),
      cartCount: document.getElementById('cart-count'),
      cartItemsContainer: document.getElementById('cart-items'),
      promoInput: document.getElementById('promo-input'),
      cartSubtotal: document.getElementById('cart-subtotal'),
      cartDiscount: document.getElementById('cart-discount'),
      cartPromo: document.getElementById('cart-promo'),
      cartTotal: document.getElementById('cart-total') 
    };
  },

  // Навешивание обработчиков событий
  bindEvents() {
    document.querySelectorAll('#cart-button').forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        this.goToBasket();
      });
    });
    
    const promoSubmitBtn = document.querySelector('.promo-submit');
    if (promoSubmitBtn) {
        promoSubmitBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const promoInput = document.getElementById('promo-input');
            if (promoInput) {
                this.applyPromoCode(promoInput.value.trim());
            }
        });
    }

    const promoRemoveBtn = document.querySelector('.promo-remove');
    if (promoRemoveBtn) {
      promoRemoveBtn.addEventListener('click', (e) => {
        e.preventDefault();
        this.removePromoCode();
      });
    }
  },

  // Переход на страницу корзины
  goToBasket() {
    this.saveCartState();
    window.location.href = 'basket.html';
  },

  // Сохранение состояния в localStorage
  saveCartState() {
    localStorage.setItem('cart', JSON.stringify({
      count: this.getTotalItemsCount(),
      items: this.items,
      discount: this.getDiscount() || null
    }));
  },

  // Восстановление состояния из localStorage
  restoreCartState() {
    const savedCart = localStorage.getItem('cart');
    if (savedCart) {
      try {
        const cartData = JSON.parse(savedCart);
        this.items = cartData.items || [];
        this.updateCount(cartData.count || '0');
        this.togglePromoRemoveButton(!!cartData.discount);
      } catch (e) {
        console.error('Ошибка восстановления корзины:', e);
        this.items = [];
      }
      } else {
      this.items = [];
      }
  },

  // Добавление товара в корзину
  addProduct(product, quantity = 1) {
    const existingItem = this.items.find(item => item.id === product.id);
    
    if (existingItem) {
      existingItem.quantity += quantity;
    } else {
      this.items.push({
        id: product.id,
        name: product.name,
        price: product.price,
        image: product.image,
        quantity: quantity
      });
    }
    
    this.recalculateDiscount();
    this.saveCartState();
    this.updateUI();
    this.showAddToCartAnimation();
  },

  // Расчет суммы без учета скидки
  calculateSubtotal() {
    return this.items.reduce((total, item) => total + (item.price * item.quantity), 0);
  },
  
  // Обновление счетчика товаров
  updateCount(count) {
    document.querySelectorAll('.cart-count').forEach(el => {
      el.textContent = count;
    });
  },
  
  // Удаление товара из корзины
  removeProduct(productId) {
    this.items = this.items.filter(item => item.id !== productId);
    this.saveCartState();
    this.updateUI();
  },

  // Изменение количества товара
  updateQuantity(productId, newQuantity) {
    const item = this.items.find(item => item.id === productId);
    if (item) {
      item.quantity = Math.max(1, newQuantity);
      this.saveCartState();
      this.updateUI();
    }
  },

  // Расчет общего количества товаров
  getTotalItemsCount() {
    return this.items.reduce((total, item) => total + item.quantity, 0);
  },

  // Получение текущей скидки
  getDiscount() {
    const cartData = JSON.parse(localStorage.getItem('cart')) || {};
    if (cartData.discount) {
      const subtotal = this.calculateSubtotal();
      return {
        code: cartData.discount.code,
        percent: cartData.discount.percent,
        amount: (subtotal * cartData.discount.percent) / 100
      };
    }
    return null;
  },

  removePromoCode() {
    const cartData = JSON.parse(localStorage.getItem('cart')) || {};
    delete cartData.discount;
    localStorage.setItem('cart', JSON.stringify(cartData));
    
    this.showNotification('Промокод удален');
    this.updateUI();
    this.togglePromoRemoveButton(false);
  },

  // Метод для показа/скрытия кнопки удаления
  togglePromoRemoveButton(show) {
    const removeBtn = document.querySelector('.promo-remove');
    if (removeBtn) {
      removeBtn.style.display = show ? 'block' : 'none';
    }
  },
  
  recalculateDiscount() {
    const cartData = JSON.parse(localStorage.getItem('cart')) || {};
    const discount = cartData.discount;
    
    if (discount) {
      const subtotal = this.calculateSubtotal();
      const newDiscountAmount = (subtotal * discount.percent) / 100;
      
      cartData.discount.amount = newDiscountAmount;
      localStorage.setItem('cart', JSON.stringify(cartData));
    }
  },
  
// Применение промокода
  applyPromoCode(promoCode) {
    const validPromoCodes = {
      'FISH10': 10,
      'FISH20': 20,
      'FISH50': 50
    };

    if (!promoCode) {
      this.showNotification('Введите промокод');
      return false;
    }

    const code = promoCode.toUpperCase();
    
    if (validPromoCodes.hasOwnProperty(code)) {
      const discountPercent = validPromoCodes[code];
      const subtotal = this.calculateSubtotal();
      const discountAmount = (subtotal * discountPercent) / 100;

      // Сохраняем скидку
      const cartData = JSON.parse(localStorage.getItem('cart')) || {};
      cartData.discount = {
        code: code,
        percent: discountPercent,
      };
      localStorage.setItem('cart', JSON.stringify(cartData));

      this.recalculateDiscount();

      this.showNotification(`Промокод "${code}" применен! Скидка ${discountPercent}%`);
      
      if (this.elements.promoInput) {
        this.elements.promoInput.value = '';
      }
      
      this.togglePromoRemoveButton(true);
      this.updateUI();
      return true;
    }
    
    this.showNotification('Неверный промокод');
    return false;
  },
  
  // Обновление интерфейса
  updateUI() {

    const count = this.getTotalItemsCount();
    this.updateCount(count);

    if (this.elements.cartItemsContainer) {
      this.renderCartItems();
    }
    
    const subtotal = this.calculateSubtotal();
    const discount = this.getDiscount();
    const discountAmount = discount ? discount.amount : 0;
    const total = Math.round(subtotal - discountAmount + this.deliveryCost);

    const deliveryElement = document.getElementById('cart-delivery');
    if (deliveryElement) {
      deliveryElement.textContent = this.deliveryCost + ' руб.';
    }
    
    this.togglePromoRemoveButton(!!discount);
    // Обновляем суммы в корзине
     if (this.elements.cartSubtotal) {
      this.elements.cartSubtotal.textContent = Math.round(subtotal) + ' руб.';
    }

    // Обновляем скидку
    if (this.elements.cartDiscount && this.elements.cartPromo) {
      if (discount) {
        this.elements.cartDiscount.textContent = `-${Math.round(discountAmount)} руб.`;
        this.elements.cartPromo.textContent = discount.code;
      } else {
        this.elements.cartDiscount.textContent = '0 руб.';
        this.elements.cartPromo.textContent = '0 руб.';
      }
    }

    // Обновляем итоговую сумму
    if (this.elements.cartTotal) {
      this.elements.cartTotal.textContent = total + ' руб.';
    }
  },

  clear() {
    this.items = [];
    localStorage.removeItem('cart');
    this.updateUI();
  },
    
  showAddToCartAnimation() {
    const cartButton = document.getElementById('cart-button');
    if (cartButton) {
      cartButton.classList.add('animate-bounce');
      setTimeout(() => {
        cartButton.classList.remove('animate-bounce');
      }, 1000);
    }
  },
    
  // Метод для отображения уведомлений
  showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'promo-notification';
    notification.textContent = message;

    const promokodContainer = document.querySelector('.promokod');
        if (promokodContainer) {
            // Удаляем предыдущие уведомления
            const oldNotifications = promokodContainer.querySelectorAll('.promo-notification');
            oldNotifications.forEach(el => el.remove());
            
            promokodContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
  },

  
  // Отрисовка товаров в корзине
  renderCartItems() {
    if (!this.elements.cartItemsContainer) return;
    
    this.elements.cartItemsContainer.innerHTML = '';
    
    this.items.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'cart-item';
      itemElement.innerHTML = `
        <div class="cart-item-container">
            <div class="cart-item-image">
              <img src="${item.image}" alt="${item.name}">
            </div>
            <div class="cart-item-details">
              <h2>${item.name}</h2>
              <div class="cart-item-price">${item.price} руб./шт. × ${item.quantity} шт.</div>
            </div>
        </div>
        <div class="cart-item-controls">
          <div class="buttons-plus-minus">
            <div class="quantity-btn minus" data-id="${item.id}" role="button"></div>
            <span class="quantity">${item.quantity}</span>
            <div class="quantity-btn plus" data-id="${item.id}" role="button"></div>
          </div>
          <div class="cart-item-total">${item.price * item.quantity} руб.</div>
          <div class="remove-btn" data-id="${item.id}" role="button"></div>
        </div>
      `;
      
      this.elements.cartItemsContainer.appendChild(itemElement);
    });
    
    document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = parseInt(e.target.getAttribute('data-id'));
        const item = this.items.find(item => item.id === id);
        if (item && item.quantity > 1) {
          this.updateQuantity(id, item.quantity - 1);
        } else {
          this.removeProduct(id);
        }
      });
    });
    
    document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = parseInt(e.target.getAttribute('data-id'));
        const item = this.items.find(item => item.id === id);
        if (item) {
          this.updateQuantity(id, item.quantity + 1);
        }
      });
    });
    
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = parseInt(e.target.getAttribute('data-id'));
        this.removeProduct(id);
      });
    });
  }

};

function initDynamicDates() {
  const formatDate = (date) => {
      const parts = date.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: 'long'
      }).split(' ');
      return parts.join('\u00A0');
  };
  const today = new Date();

  const dayAfterTomorrow = new Date();
  dayAfterTomorrow.setDate(today.getDate() + 2);

  const rangeStart = new Date();
  rangeStart.setDate(today.getDate() + 2);

  const rangeEnd = new Date();
  rangeEnd.setDate(today.getDate() + 4);

  const todayElem = document.querySelector('.date-today');
  const dayAfterTomorrowElem = document.querySelector('.date-day-after-tomorrow');
  const rangeElem = document.querySelector('.date-range');

  if (todayElem) todayElem.textContent = formatDate(today);
  if (dayAfterTomorrowElem) dayAfterTomorrowElem.textContent = formatDate(dayAfterTomorrow);
  if (rangeElem) {
    rangeElem.textContent = `${formatDate(rangeStart)} — ${formatDate(rangeEnd)}`;
  }
}

function initCheckoutRedirect() {
  const checkoutBtn = document.querySelector('.checkout-btn');
  if (checkoutBtn) {
    checkoutBtn.addEventListener('click', () => {
      window.location.href = '/make_an_order.html';
    });
  }
}

function init404Redirect() {
  const redirectBtn = document.querySelector('.cameback');
  if (redirectBtn) {
    redirectBtn.addEventListener('click', () => {
      window.location.href = '/index.html';
    });
  }
}

function initBasketRedirect() {
  const arrowbackBtn = document.querySelector('.arrow_back');
  if (arrowbackBtn) {
    arrowbackBtn.addEventListener('click', () => {
      window.location.href = '/basket.html';
    });
  }
}

function initPaymentMethodSelection() {
  const paymentMethods = document.querySelectorAll('.method-payment');

  paymentMethods.forEach(method => {
    method.addEventListener('click', () => {
      const isActive = method.classList.contains('active');
      paymentMethods.forEach(el => el.classList.remove('active'));
      if (!isActive) {
        method.classList.add('active');
      }
    });
  });
}

function initDeliveryTabs() {
  const receiveBlocks = document.querySelectorAll('.receive');
  const contentBlocks = {
    self: document.getElementById('self-content'),
    courier: document.getElementById('courier-content'),
    'mail-russia': document.getElementById('mail-content')
  };

  receiveBlocks.forEach(block => {
    block.addEventListener('click', () => {
      
      receiveBlocks.forEach(el => el.classList.remove('active'));
      block.classList.add('active');

      Object.values(contentBlocks).forEach(el => el.style.display = 'none');

      const id = block.id;
      if (contentBlocks[id]) {
        contentBlocks[id].style.display = 'block';
      }

         if (block.id === 'courier') {
          Cart.deliveryCost = 400;
        } else if (block.id === 'mail-russia') {
          Cart.deliveryCost = 120;
        } else {
          Cart.deliveryCost = 0;
      }
       
        Cart.updateUI();
    });
  });
}

function initDeliveryAndPaymentSelection() {
  const paymentOptions = document.querySelectorAll('.method-payment');

  paymentOptions.forEach(option => {
    option.addEventListener('click', () => {
      paymentOptions.forEach(o => o.classList.remove('active'));
      option.classList.add('active');
    });
  });
}

function initCheckoutProcess() {
  const checkoutBtn = document.querySelector('.checkout-btn');
  const form = document.getElementById('order-form');

  if (!checkoutBtn || !form) return;

  checkoutBtn.addEventListener('click', (e) => {
    e.preventDefault();

    if (!validateOrderForm()) {
      alert('Пожалуйста, заполните все поля.');
      return;
    }

    showThankYouZakazModal();
    Cart.clear();
    Cart.updateUI();
    form.reset();
  });
}

function validateOrderForm() {
  const name = document.querySelector('input[name="name"]');
  const phone = document.querySelector('input[name="phone"]');
  const email = document.querySelector('input[name="email"]');

  let valid = true;

  [name, phone, email].forEach(input => {
    if (!input.value.trim()) {
      input.classList.add('input-error');
      valid = false;
    } else {
      input.classList.remove('input-error');
    }
  });

  if (!valid) {
    alert('Пожалуйста, заполните все контактные данные.');
    return false;
  }

  const selectedDelivery = document.querySelector('.receive.active');
  if (!selectedDelivery) {
    alert('Пожалуйста, выберите способ доставки.');
    return false;
  }

  const deliveryId = selectedDelivery.id;

  if (deliveryId === 'courier' || deliveryId === 'mail-russia') {
    const addressBlock = document.querySelector(`#${deliveryId}-content`);
    const addressInputs = addressBlock.querySelectorAll('input[type="text"]');
    let allFilled = true;

    addressInputs.forEach(input => {
      if (!input.value.trim()) {
        input.classList.add('input-error');
        allFilled = false;
      } else {
        input.classList.remove('input-error');
      }
    });

    if (deliveryId === 'courier') {
      const timeFrom = document.getElementById('time-from');
      const timeTo = document.getElementById('time-to');

      if (!timeFrom.value.trim() || !timeTo.value.trim()) {
        timeFrom.classList.add('input-error');
        timeTo.classList.add('input-error');
        alert('Пожалуйста, выберите время получения заказа.');
        return false;
      } else {
        timeFrom.classList.remove('input-error');
        timeTo.classList.remove('input-error');
      }
    }

    if (!allFilled) {
      alert('Пожалуйста, заполните все поля адреса доставки.');
      return false;
    }
  }

  const selectedPayment = document.querySelector('.method-payment.active');
  if (!selectedPayment) {
    alert('Пожалуйста, выберите способ оплаты.');
    return false;
  }

  return true;
}


function showThankYouZakazModal() {
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal">
      <h2>ВАШ ЗАКАЗ ОФОРМЛЕН!</h2>
      <p>Спасибо, что выбрали наш&nbsp;магазин!</p>
      <p style="color: #fff;">Д</p>
      <p>Для&nbsp;подтверждения заказа с&nbsp;вами свяжется наш&nbsp;сотрудник. Если заказ сделан в&nbsp;будни с&nbsp;9:00 до&nbsp;18:00 —&nbsp;мы&nbsp;свяжемся с&nbsp;вами в&nbsp;течение&nbsp;15&nbsp;минут</p>
      <p style="color: #fff;">Д</p>
      <p>В другое время позвоним утром следующего рабочего дня</p>
      <button id="go-to-home">На главную</button>
    </div>
  `;
  document.body.appendChild(modal);
  document.body.style.overflow = 'hidden';

  modal.querySelector('#go-to-home').addEventListener('click', () => {
    window.location.href = '/index.html';
  });
}
